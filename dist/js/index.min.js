( function(){

    "use strict";

    $(function(){

        $.each( $( '.menu' ), function() {
            new Menu ( $( this ) );
        } );

        $.each( $( '.site__header' ), function() {
            new Header ( $( this ) );
        } );

        $.each( $( '.place' ), function() {
            new Place ( $( this ) );
        } );

    } );

    var Menu = function( obj ) {

        //private properties
        var _obj = obj,
            _mobileBtn = $( '.menu-mobile-btn' ),
            _closeBtn = _obj.find( '.menu-close-btn' ),
            _body = $( 'body' ),
            _site = _body.find( '.site' ),
            _siteHead = _site.find( '.site__header' ),
            _window = $( window ),
            _position = 0;

        //private methods
        var _onEvent = function() {

                _mobileBtn.on( 'click', function () {
                    _showMobileMenu();
                    return false;
                } );

                _closeBtn.on( 'click', function () {
                    _hideMobileMenu();
                    return false;
                } );

            },
            _hideMobileMenu = function () {

                _obj.removeClass( 'show' );

                _body.removeAttr( 'style' );
                _site.removeAttr( 'style' );
                _siteHead.removeClass( 'open-menu' );

                _window.scrollTop( _position );

            },
            _showMobileMenu = function () {

                _obj.addClass( 'show' );

                _position = _window.scrollTop();

                _body.css( 'overflow-y', 'hidden' );

                _site.css( {
                    'position': 'relative',
                    'top': _position * -1
                } );

                _siteHead.addClass( 'open-menu' );

            },
            _init = function() {
                _onEvent();
            };

        //public properties

        //public methods

        _init();
    };

    var Header = function( obj ) {

        //private properties
        var _obj = obj,
            _hero = $( '.hero' ),
            _heroBottomSet = 0,
            _headerBottomSet = 0,
            _window = $( window );

            if ( _hero.length > 0 ){

                _heroBottomSet = _hero.offset().top + _hero.outerHeight();
                _headerBottomSet = _obj.offset().top + _obj.outerHeight();

            }

        //private methods
        var _onEvent = function() {

                _window.on( 'scroll', function () {
                    _checkScroll();
                } );

            },
            _checkScroll = function () {

                if ( _headerBottomSet * 5 < _window.scrollTop() && _window.scrollTop() < _heroBottomSet ){
                    _hideHeader();
                } else if ( _window.scrollTop() > _heroBottomSet ) {
                    _fixedHeader();
                } else {
                    _headerOnTop();
                }

            },
            _hideHeader = function () {
                _obj.addClass( 'hide' );
            },
            _fixedHeader = function () {
                _obj.addClass( 'fixed' );
                _obj.removeClass( 'hide' );
            },
            _headerOnTop = function () {
                _obj.removeClass( 'hide' );
                _obj.removeClass( 'fixed' );
            },
            _init = function() {
                _onEvent();
                _checkScroll();
            };

        //public properties

        //public methods

        _init();
    };

    var Place = function( obj ) {

        //private properties
        var _obj = obj,
            _curCity = _obj.find( '.place__current' ),
            _citiesPopup = _obj.find( '.place__popup' ),
            _citiesWrap = _citiesPopup.find( '.place__cities' ),
            _listCountries = _citiesPopup.find( '.place__countries' ),
            _countriesSlide = _listCountries.find( '.swiper-slide' ),
            _listCountryItem = _listCountries.find( '.place__countries-item' ),
            _closePopup = _citiesPopup.find( '.place__popup-close' ),
            _body = $( 'body' ),
            _site = $( '.site' ),
            _siteHead = _site.find( '.site__header' ),
            _window = $( window ),
            _position = 0,
            _swiperCountries,
            _request = new XMLHttpRequest();

        //private methods
        var _onEvent = function() {

                _site.on( 'click', function ( e ) {
                    if ( _obj.hasClass( 'show' ) && $( e.target ).closest( _obj ).length == 0 && _window.width() <= 1200 ){
                        _hidePopupOnMobile();
                    }
                } );

                _curCity.on( 'click', function () {

                    if ( !_siteHead.hasClass( 'open-menu' ) ) {
                        _showPopupOnMobile();
                    }

                } );

                _closePopup.on( 'click', function () {
                    _hidePopupOnMobile();
                    return false;
                } );

                _listCountryItem.on( 'click', function () {

                    var cutCountry = $( this );

                    _ajaxRequest( cutCountry );

                    _listCountryItem.removeClass( 'active' );
                    cutCountry.addClass( 'active' );

                    return false;
                } );

            },
            _ajaxRequest = function( countryObj ) {

                var cutCountry = countryObj,
                    cutCountryId = cutCountry.data( 'country' );

                _request = $.ajax( {
                    url: 'php/city.geo.php',
                    data: {
                        country_id: cutCountryId
                    },
                    dataType: 'json',
                    type: 'GET',
                    success: function ( data ) {
                        _constructData( data );
                    },
                    error: function ( XMLHttpRequest ) {
                        if ( XMLHttpRequest.statusText != "abort" ) {
                            console.log( 'err' );
                        }
                    }
                } );

            },
            _checkActiveTab = function () {

                if ( _listCountryItem.filter( 'active' ).length == 0 ){

                    _listCountryItem.eq( 0 ).trigger( 'click' );

                }

            },
            _constructData = function ( data ) {

                _citiesWrap.empty();

                $.each( data, function ( i ) {

                    var list = $( '<dl></dl>' );

                    for ( var n = 0; n < data.length; n++ ) {

                        list.append( '<dt>'+ data[ i ][ n ].group +'</dt>' );
                        list.append( _appendCities( data[ i ][ n ].city ) );

                    };

                    _citiesWrap.append( list );

                } );

            },
            _appendCities = function ( data ) {

                var list = $( '<dd></dd>' );

                for ( var i = 0; i < data.length; i++ ) {

                    list.append( '<a href="'+ data[ i ].link +'">'+ data[ i ].name  +'</a>' );

                };

                return list;

            },
            _getScrollWidth = function (){
                var scrollDiv = document.createElement( 'div'),
                    scrollBarWidth;

                scrollDiv.className = 'place__scrollbar-measure';

                document.body.appendChild( scrollDiv );

                scrollBarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;

                document.body.removeChild(scrollDiv);

                return scrollBarWidth;
            },
            _showPopupOnMobile = function () {

                _obj.addClass( 'show' );

                _position = _window.scrollTop();

                var headerRightPadding = +( _siteHead.css( 'padding-right' ).replace( 'px', '' ) ),
                    headerLeftPadding = +( _siteHead.css( 'padding-left' ).replace( 'px', '' ) );

                _body.css( 'overflow-y', 'hidden' );

                _site.css( {
                    'position': 'relative',
                    'top': _position * -1
                } );

                _siteHead.addClass( 'open-menu' );

                if ( _window.outerWidth() >= 768 ){

                    _siteHead.css( {
                        'padding-left': headerLeftPadding,
                        'padding-right': headerRightPadding + _getScrollWidth()
                    } );

                    _citiesPopup.css( {
                        'padding-left': headerLeftPadding,
                        'padding-right': headerRightPadding + _getScrollWidth() + 17
                    } );

                    _closePopup.css( 'right', headerRightPadding + _getScrollWidth() );

                }

                _citiesWrap.niceScroll( {
                    cursorcolor: "#2f2f2f",
                    cursorwidth: "4px",
                    cursorborder: "0",
                    background: "#1a1a1a",
                    autohidemode: false
                } );

            },
            _hidePopupOnMobile = function () {

                _obj.removeClass( 'show' );

                _body.removeAttr( 'style' );
                _site.removeAttr( 'style' );
                _siteHead.removeClass( 'open-menu' );
                _siteHead.removeAttr( 'style' );

                console.log( _position )

                _window.scrollTop( _position );

                _citiesWrap.niceScroll( 'destroy' );

            },
            _initScheduleScroll = function () {

                if ( _countriesSlide.outerWidth() > _listCountries.outerWidth() ) {

                    _swiperCountries = new Swiper( _listCountries, {
                        direction: 'horizontal',
                        slidesPerView: 'auto',
                        freeMode: true,
                        mousewheel: true
                    } );

                }

            },
            _init = function() {
                _onEvent();
                _checkActiveTab();
                _initScheduleScroll();
            };

        //public properties

        //public methods

        _init();
    };

} )();
( function(){

    "use strict";

    $(function(){

        $.each( $( '.hero, .gratitude' ), function() {
            new Sliders ( $( this ) );
        } );

        $.each( $( '.schedule__month' ), function() {
            new Schedule ( $( this ) );
        } );

        $.each( $( '.subscribe' ), function() {
            new SubscribeForm ( $( this ) );
        } );

        $.each( $( '.popup__add' ), function() {
            new AddForm ( $( this ) );
        } );

        $.each( $( '.popup__event' ), function() {
            new EventForm ( $( this ) );
        } );

        $.each( $( '.popup__help' ), function() {
            new HelpForm ( $( this ) );
        } );

        $.each( $( '.popup__volunteer' ), function() {
            new VolunteerForm ( $( this ) );
        } );

    });

    var Schedule = function( obj ) {

        //private properties
        var _obj = obj,
            _now = new Date(),
            _currentYear = _now.getFullYear(),
            _currentMonth = _now.getMonth(),
            _options = { month: 'long' },
            _monthTitle = _obj.find( '.schedule__month-name' ),
            _monthDaysWrap = _obj.find( '.schedule__month-days' ),
            _monthDaysSlide = _monthDaysWrap.find( '.swiper-slide' ),
            _scrollDays = _monthDaysWrap.find( '.schedule__month-scrollbar' ),
            _schedulePlan = _obj.find( '.schedule__plan' ),
            _schedulePlanSlide = _schedulePlan.find( '.schedule__plan-slide' ),
            _scrollSchedule = _schedulePlan.find( '.schedule__plan-scrollbar' ),
            _dateBtn, _swiperSchedule, _swiperCalendar,
            _window = $( window ),
            _request = new XMLHttpRequest();

        //private methods
        var _ajaxRequest = function( year, month, date ) {

                _request = $.ajax( {
                    url: 'php/schedule.php',
                    data: {
                        year: year,
                        month: month,
                        date: date
                    },
                    dataType: 'json',
                    type: 'GET',
                    success: function ( data ) {

                        _loadData( data );

                    },
                    error: function ( XMLHttpRequest ) {
                        if ( XMLHttpRequest.statusText != "abort" ) {
                            console.log( 'err' );
                        }
                    }
                } );

            },
            _initCalendarScroll = function () {

                _swiperCalendar = new Swiper( _monthDaysWrap, {
                    direction: 'horizontal',
                    slidesPerView: 'auto',
                    freeMode: true,
                    scrollbar: _scrollDays,
                    mousewheel: true
                } );

            },
            _getLocalDay = function ( date ) {

                var day = date.getDay();

                if ( day == 0 ) {
                    day = 7;
                }

                return day;

            },
            _getLastDayOfMonth = function ( year, month ) {
                var date = new Date( year, month + 1, 0 );
                return date.getDate();
            },
            _setCalendar = function () {

                _monthTitle.text( _now.toLocaleString( "ru", _options ) );

                for ( var i = 1; i <= _getLastDayOfMonth( _currentYear, _currentMonth ); i++ ) {

                    var weekDay =  _getLocalDay( new Date( _currentYear, _currentMonth, i ) );

                    if ( weekDay == 6 || weekDay == 7 ) {
                        _monthDaysSlide.append( '<a href="#" class="weekend">'+ i +'</a>' );
                    } else {
                        _monthDaysSlide.append( '<a href="#">'+ i +'</a>' );
                    }

                }

                _dateBtn = _monthDaysSlide.find( 'a' );

                _onEvent();

                _dateBtn.eq( _now.getDate() ).addClass( 'today' ).trigger( 'click' );

                if ( _window.outerWidth() < 1170 ){

                    _initCalendarScroll();

                }

            },
            _loadData = function ( data ) {

                _schedulePlanSlide.empty();

                if ( _swiperSchedule != undefined ){
                    _schedulePlan[ 0 ].swiper.destroy( false, true );
                }

                var arr = data.items,
                    number = arr.length;

                if ( number > 0 ){

                    for ( var i = 0; i < number; i++ ){

                        _schedulePlanSlide.append( '<a href="'+ arr[i].link +'" class="schedule__plan-item">'+ arr[i].title +'</a>' );

                    }
                    _scrollSchedule.removeAttr( 'style' );
                    _initScheduleScroll();

                } else {

                    _schedulePlanSlide.html( '<div class="schedule__plan-item empty">Сегодня событий нет</div>' );
                    _scrollSchedule.css( 'visibility', 'hidden' )

                }

            },
            _initScheduleScroll = function () {

                _swiperSchedule = new Swiper( _schedulePlan, {
                    direction: 'horizontal',
                    slidesPerView: 'auto',
                    freeMode: true,
                    scrollbar: _scrollSchedule,
                    mousewheel: true
                } );

            },
            _onEvent = function() {

                _dateBtn.on( 'click', function () {

                    var curElem = $( this );

                    _dateBtn.removeClass( 'active' );
                    curElem.addClass( 'active' );

                    _ajaxRequest( _currentYear, _currentMonth, curElem.text() );

                    return false;

                } );

            },
            _init = function() {
                _setCalendar();
            };

        //public properties

        //public methods

        _init();
    };

    var Sliders = function( obj ) {

        //private properties
        var _obj = obj,
            _heroSlider = _obj.find( '.hero__slider' ),
            _gratitudeSlider = _obj.find( '.gratitude__list' ),
            _heroSlide = _heroSlider.find( '.hero__slide' ),
            _heroPagination = _obj.find( '.hero__pagination' ),
            _gratitudePagination = _obj.find( '.gratitude__pagination' ),
            _hero,
            _gratitude;

        //private methods
        var _initSlider = function() {

                if ( _heroSlide.length > 1 ) {

                    _hero = new Swiper ( _heroSlider, {
                        effect: 'slide',
                        autoplay: 2500,
                        speed: 500,
                        slidesPerView: 1,
                        loop: true,
                        pagination: _heroPagination,
                        paginationClickable: true
                    } );

                }

                _gratitude = new Swiper ( _gratitudeSlider, {
                    effect: 'fade',
                    autoplay: 2000,
                    speed: 500,
                    slidesPerView: 1,
                    loop: true,
                    pagination: _gratitudePagination,
                    paginationClickable: true
                } );

            },
            _init = function() {
                _initSlider();
            };

        //public properties

        //public methods

        _init();
    };

    var SubscribeForm = function( obj ){

        //private properties
        var _obj = obj,
            _emailFielder = _obj.find( 'input[type=email]' ),
            _btn = _obj.find( 'button' ),
            _successMessage = _obj.find( '.subscribe__success' ),
            _validation = new FormValidator( _obj );

        //private methods
        var _init = function(){
                _onEvent();
            },
            _onEvent = function(){

                _obj.on( 'submit', function () {

                    if ( _validation.valid == true ) {
                        _ajaxSend();
                    }

                    return false;

                } );

            },
            _ajaxSend = function(){

                $.ajax( {
                    url: 'php/sender.php',
                    dataType: 'html',
                    timeout: 20000,
                    type: "POST",
                    data: {
                        email: _emailFielder.val()
                    },
                    success: function () {

                        _showSuccessMessage();

                    },
                    error: function (XMLHttpRequest) {
                        if (XMLHttpRequest.statusText != 'abort') {
                            alert(XMLHttpRequest.statusText);
                        }
                    }
                } );
                return false;

            },
            _showSuccessMessage = function () {

                _successMessage.addClass( 'show' );

                _obj[0].reset();

                setTimeout( function () {
                    _successMessage.removeClass( 'show' );
                }, 4000 );

            };

        //public properties

        //public methods

        _init();

    };

    var AddForm = function( obj ){

        //private properties
        var _obj = obj,
            _emailFielder = _obj.find( 'input[type=email]' ),
            _urlFielder = _obj.find( 'input[type=text]' ),
            _messageFielder = _obj.find( 'textarea' ),
            _btn = _obj.find( 'button' ),
            _successMessage = _obj.find( '.popup__success' ),
            _validation = new FormValidator( _obj );

        //private methods
        var _init = function(){
                _onEvent();
            },
            _onEvent = function(){

                _obj.on( 'submit', function () {

                    if ( _validation.valid == true ) {
                        _ajaxSend();
                    }

                    return false;

                } );

            },
            _ajaxSend = function(){

                $.ajax( {
                    url: 'php/sender.php',
                    dataType: 'html',
                    timeout: 20000,
                    type: "POST",
                    data: {
                        email: _emailFielder.val(),
                        url: _urlFielder.val(),
                        message: _messageFielder.val()
                    },
                    success: function () {

                        _showSuccessMessage();

                    },
                    error: function (XMLHttpRequest) {
                        if (XMLHttpRequest.statusText != 'abort') {
                            alert(XMLHttpRequest.statusText);
                        }
                    }
                } );
                return false;

            },
            _showSuccessMessage = function () {

                _successMessage.addClass( 'show' );

                _obj[0].reset();

                setTimeout( function () {
                    $( '.popup' )[0].obj.close(0);

                    setTimeout( function () {
                        _successMessage.removeClass('show');
                    }, 300 );

                }, 2000 );

            };

        //public properties

        //public methods

        _init();

    };

    var EventForm = function( obj ){

        //private properties
        var _obj = obj,
            _emailFielder = _obj.find( 'input[type=email]' ),
            _urlFielder = _obj.find( 'input[type=text]' ),
            _messageFielder = _obj.find( 'textarea' ),
            _btn = _obj.find( 'button' ),
            _successMessage = _obj.find( '.popup__success' ),
            _validation = new FormValidator( _obj );

        //private methods
        var _init = function(){
                _onEvent();
            },
            _onEvent = function(){

                _obj.on( 'submit', function () {

                    if ( _validation.valid == true ) {
                        _ajaxSend();
                    }

                    return false;

                } );

            },
            _ajaxSend = function(){

                $.ajax( {
                    url: 'php/sender.php',
                    dataType: 'html',
                    timeout: 20000,
                    type: "POST",
                    data: {
                        email: _emailFielder.val(),
                        palce: _urlFielder.val(),
                        message: _messageFielder.val()
                    },
                    success: function () {

                        _showSuccessMessage();

                    },
                    error: function (XMLHttpRequest) {
                        if (XMLHttpRequest.statusText != 'abort') {
                            alert(XMLHttpRequest.statusText);
                        }
                    }
                } );
                return false;

            },
            _showSuccessMessage = function () {

                _successMessage.addClass( 'show' );

                _obj[0].reset();

                setTimeout( function () {
                    $( '.popup' )[0].obj.close(0);

                    setTimeout( function () {
                        _successMessage.removeClass('show');
                    }, 300 );

                }, 2000 );

            };

        //public properties

        //public methods

        _init();

    };

    var HelpForm = function( obj ){

        //private properties
        var _obj = obj,
            _emailFielder = _obj.find( 'input[type=email]' ),
            _urlFielder = _obj.find( 'input[type=text]' ),
            _messageFielder = _obj.find( 'textarea' ),
            _btn = _obj.find( 'button' ),
            _successMessage = _obj.find( '.popup__success' ),
            _validation = new FormValidator( _obj );

        //private methods
        var _init = function(){
                _onEvent();
            },
            _onEvent = function(){

                _obj.on( 'submit', function () {

                    if ( _validation.valid == true ) {
                        _ajaxSend();
                    }

                    return false;

                } );

            },
            _ajaxSend = function(){

                $.ajax( {
                    url: 'php/sender.php',
                    dataType: 'html',
                    timeout: 20000,
                    type: "POST",
                    data: {
                        email: _emailFielder.val(),
                        palce: _urlFielder.val(),
                        message: _messageFielder.val()
                    },
                    success: function () {

                        _showSuccessMessage();

                    },
                    error: function (XMLHttpRequest) {
                        if (XMLHttpRequest.statusText != 'abort') {
                            alert(XMLHttpRequest.statusText);
                        }
                    }
                } );
                return false;

            },
            _showSuccessMessage = function () {

                _successMessage.addClass( 'show' );

                _obj[0].reset();

                setTimeout( function () {
                    $( '.popup' )[0].obj.close(0);

                    setTimeout( function () {
                        _successMessage.removeClass('show');
                    }, 300 );

                }, 2000 );

            };

        //public properties

        //public methods

        _init();

    };

    var VolunteerForm = function( obj ){

        //private properties
        var _obj = obj,
            _emailFielder = _obj.find( 'input[type=email]' ),
            _urlFielder = _obj.find( 'input[type=text]' ),
            _messageFielder = _obj.find( 'textarea' ),
            _btn = _obj.find( 'button' ),
            _successMessage = _obj.find( '.popup__success' ),
            _validation = new FormValidator( _obj );

        //private methods
        var _init = function(){
                _onEvent();
            },
            _onEvent = function(){

                _obj.on( 'submit', function () {

                    if ( _validation.valid == true ) {
                        _ajaxSend();
                    }

                    return false;

                } );

            },
            _ajaxSend = function(){

                $.ajax( {
                    url: 'php/sender.php',
                    dataType: 'html',
                    timeout: 20000,
                    type: "POST",
                    data: {
                        email: _emailFielder.val(),
                        palce: _urlFielder.val(),
                        message: _messageFielder.val()
                    },
                    success: function () {

                        _showSuccessMessage();

                    },
                    error: function (XMLHttpRequest) {
                        if (XMLHttpRequest.statusText != 'abort') {
                            alert(XMLHttpRequest.statusText);
                        }
                    }
                } );
                return false;

            },
            _showSuccessMessage = function () {

                _successMessage.addClass( 'show' );

                _obj[0].reset();

                setTimeout( function () {
                    $( '.popup' )[0].obj.close(0);

                    setTimeout( function () {
                        _successMessage.removeClass('show');
                    }, 300 );

                }, 2000 );

            };

        //public properties

        //public methods

        _init();

    };

} )();
var FormValidator = function (obj) {

    //private properties
    var _obj = obj,
        _self = this,
        _inputs = _obj.find( 'input, textarea' ),
        _fields = _obj.find( '[data-required]' ),
        _checkbox = _obj.find( 'input[type=checkbox]' );

    //private methods
    var _init = function () {
            _onEvents();
            _obj[ 0 ].obj = _self;
        },
        _addNotTouchedClass = function () {

            _fields.each( function() {

                var curItem = $(this);

                if( curItem.val() === '' || !curItem.is( ':checked' ) ){

                    curItem.addClass( 'not-touched' );

                    _validateField( curItem );

                }

                if ( curItem.hasClass( 'valid' ) ){
                    curItem.removeClass( 'not-touched' );
                }

            } );

        },
        _onEvents = function () {
            _fields.on( {
                focus: function() {

                    $( this ).removeClass( 'not-touched' );

                },
                focusout: function() {

                    var curItem = $(this);

                    _validateField( curItem );

                },
                keyup: function () {

                    var curItem = $(this);

                    if ( curItem.hasClass( 'not-valid' ) ){
                        _validateField( curItem );
                    }

                }
            } );
            _inputs.on( {
                focusout: function() {

                    var letterCounter = 0;

                    _inputs.each( function () {

                        var curItem = $(this);

                        if ( curItem.val().length > 0 ){
                            letterCounter = letterCounter + 1
                        }

                    } );

                    if ( letterCounter === 0 ) {
                        _inputs.removeClass( 'not-valid' );
                        _self.valid = false;
                    }

                }
            } );
            _obj.on( {
                submit: function() {

                    _addNotTouchedClass();

                    if( !(_fields.filter( '.not-valid' ).length === 0) ) {
                        _self.valid = false;
                    }

                    if( _fields.hasClass( 'not-touched' ) || _fields.hasClass( 'not-valid' ) ) {
                        _obj.find('.not-touched:first').focus();
                        _obj.find('.not-valid:first').focus();
                        _self.valid = false;
                        return false;
                    };

                }
            } );
            _checkbox.on( 'change', function () {

                $( this ).removeClass( 'not-valid not-touched' );

            } );
        },
        _makeNotValid = function ( field ) {
            field.addClass( 'not-valid' );
            field.removeClass( 'valid' );
        },
        _makeValid = function ( field ) {
            field.removeClass( 'not-valid' );
            field.addClass( 'valid' );
        },
        _validateEmail = function ( email ) {
            var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
        },
        _validateField = function ( field ) {

            var type = field.attr( 'type' ),
                tagName = field[0].tagName;

            if( type === 'email' || type === 'text'  || type === 'tel' ){

                if( field.val() === '' ){
                    _makeNotValid( field );
                    _self.valid = false;
                    return false;
                }

            }

            if( type === 'email' ){
                if( !_validateEmail( field.val() ) ){
                    _makeNotValid( field );
                    _self.valid = false;
                    return false;
                }
            }

            if( type === 'checkbox' ){

                if( !field.is( ':checked' ) ){
                    _makeNotValid( field );
                    _self.valid = false;
                    return false;
                }

            }

            if( tagName.toLocaleLowerCase() == 'textarea' ){

                if( field.val() === '' ){
                    _makeNotValid( field );
                    _self.valid = false;
                    return false;
                }

            }

            _makeValid( field );

            if( _fields.filter( '.not-valid' ).length === 0 ) {

                _self.valid = true;

            }

        };

    //public properties
    _self.valid = false;

    _init();
};
( function(){

    $( function(){

        $( '.popup' ).each(function(){

            new Popup($(this));

        });

    });

    var Popup = function( obj ){

        //private properties
        var _self = this,
            _btnShow =  $( '.popup__open' ),
            _obj = obj,
            _btnClose = _obj.find( '.popup__close, .popup__cancel' ),
            _wrap = _obj.find( '.popup__wrap' ),
            _contents = _obj.find( '.popup__content' ),
            _scrollConteiner = $( 'html' ),
            _window = $( window ),
            _timer = setTimeout( function(){}, 1 );

        //private methods
        var _centerWrap = function(){
                if ( _wrap.outerHeight() < _window.outerHeight() && _window.outerWidth() >= 768 ) {
                    _wrap.css( { top: ( _window.outerHeight() - _wrap.outerHeight() ) / 2 } );
                } else {
                    _wrap.css( { top: 0 } );
                }
            },
            _getScrollWidth = function (){
                var scrollDiv = document.createElement( 'div'),
                    scrollBarWidth;

                scrollDiv.className = 'popup__scrollbar-measure';

                document.body.appendChild( scrollDiv );

                scrollBarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;

                document.body.removeChild(scrollDiv);

                return scrollBarWidth;
            },
            _hide = function(){
                _obj.css( {
                    overflowY: 'hidden'
                } );
                _scrollConteiner.css( {
                    overflowY: 'auto',
                    paddingRight: 0
                } );

                _obj.removeClass( 'popup_opened' );
                _obj.addClass( 'popup_hide' );

                _timer = setTimeout( function(){

                    _obj.css ({
                        overflowY: 'auto'
                    });

                    _obj.removeClass( 'popup_hide' );
                }, 300 );

            },
            _init = function(){
                _obj[ 0 ].obj = _self;
                _onEvents();
            },
            _onEvents = function(){
                _window.on( {
                    resize: function(){
                        _centerWrap();
                    }
                } );
                _btnShow.on( {
                    click: function(){
                        _show( $( this ).attr( 'data-popup' ) );
                        return false;
                    }
                } );
                _wrap.on( {
                    click: function( e ){
                        e.stopPropagation();
                    }
                } );
                _obj.on( {
                    click: function(){
                        _hide();
                        return false;
                    }
                } );
                _btnClose.on( {
                    click: function(){
                        _hide();
                        return false;
                    }
                } );
            },
            _show = function( className ){
                _setPopupContent( className );

                _scrollConteiner.css( {
                    overflowY: 'hidden',
                    paddingRight: _getScrollWidth()
                } );
                _obj.addClass( 'popup_opened' );
                _centerWrap();

            },
            _setPopupContent = function( className ){
                var curContent = _contents.filter( '.popup__' + className );

                _contents.css( { display: 'none' } );
                curContent.css( { display: 'block' } );
            };

        //public properties

        //public methods
        _self.close = function(){
            _hide();
        };

        _init();
    };

} )();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5tYWluLmpzIiwianF1ZXJ5LmluZGV4LmpzIiwianF1ZXJ5LmZvcm0udmFsaWRhdG9yLmpzIiwianF1ZXJ5LnBvcHVwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6V0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiaW5kZXgubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKCBmdW5jdGlvbigpe1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAkKGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgJC5lYWNoKCAkKCAnLm1lbnUnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IE1lbnUgKCAkKCB0aGlzICkgKTtcbiAgICAgICAgfSApO1xuXG4gICAgICAgICQuZWFjaCggJCggJy5zaXRlX19oZWFkZXInICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IEhlYWRlciAoICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgJC5lYWNoKCAkKCAnLnBsYWNlJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5ldyBQbGFjZSAoICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICB9ICk7XG5cbiAgICB2YXIgTWVudSA9IGZ1bmN0aW9uKCBvYmogKSB7XG5cbiAgICAgICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICAgICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgICAgICBfbW9iaWxlQnRuID0gJCggJy5tZW51LW1vYmlsZS1idG4nICksXG4gICAgICAgICAgICBfY2xvc2VCdG4gPSBfb2JqLmZpbmQoICcubWVudS1jbG9zZS1idG4nICksXG4gICAgICAgICAgICBfYm9keSA9ICQoICdib2R5JyApLFxuICAgICAgICAgICAgX3NpdGUgPSBfYm9keS5maW5kKCAnLnNpdGUnICksXG4gICAgICAgICAgICBfc2l0ZUhlYWQgPSBfc2l0ZS5maW5kKCAnLnNpdGVfX2hlYWRlcicgKSxcbiAgICAgICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKSxcbiAgICAgICAgICAgIF9wb3NpdGlvbiA9IDA7XG5cbiAgICAgICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIF9vbkV2ZW50ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBfbW9iaWxlQnRuLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF9zaG93TW9iaWxlTWVudSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgX2Nsb3NlQnRuLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF9oaWRlTW9iaWxlTWVudSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hpZGVNb2JpbGVNZW51ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgX29iai5yZW1vdmVDbGFzcyggJ3Nob3cnICk7XG5cbiAgICAgICAgICAgICAgICBfYm9keS5yZW1vdmVBdHRyKCAnc3R5bGUnICk7XG4gICAgICAgICAgICAgICAgX3NpdGUucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuICAgICAgICAgICAgICAgIF9zaXRlSGVhZC5yZW1vdmVDbGFzcyggJ29wZW4tbWVudScgKTtcblxuICAgICAgICAgICAgICAgIF93aW5kb3cuc2Nyb2xsVG9wKCBfcG9zaXRpb24gKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zaG93TW9iaWxlTWVudSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9vYmouYWRkQ2xhc3MoICdzaG93JyApO1xuXG4gICAgICAgICAgICAgICAgX3Bvc2l0aW9uID0gX3dpbmRvdy5zY3JvbGxUb3AoKTtcblxuICAgICAgICAgICAgICAgIF9ib2R5LmNzcyggJ292ZXJmbG93LXknLCAnaGlkZGVuJyApO1xuXG4gICAgICAgICAgICAgICAgX3NpdGUuY3NzKCB7XG4gICAgICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICd0b3AnOiBfcG9zaXRpb24gKiAtMVxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIF9zaXRlSGVhZC5hZGRDbGFzcyggJ29wZW4tbWVudScgKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgX29uRXZlbnQoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgICAgIC8vcHVibGljIG1ldGhvZHNcblxuICAgICAgICBfaW5pdCgpO1xuICAgIH07XG5cbiAgICB2YXIgSGVhZGVyID0gZnVuY3Rpb24oIG9iaiApIHtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9oZXJvID0gJCggJy5oZXJvJyApLFxuICAgICAgICAgICAgX2hlcm9Cb3R0b21TZXQgPSAwLFxuICAgICAgICAgICAgX2hlYWRlckJvdHRvbVNldCA9IDAsXG4gICAgICAgICAgICBfd2luZG93ID0gJCggd2luZG93ICk7XG5cbiAgICAgICAgICAgIGlmICggX2hlcm8ubGVuZ3RoID4gMCApe1xuXG4gICAgICAgICAgICAgICAgX2hlcm9Cb3R0b21TZXQgPSBfaGVyby5vZmZzZXQoKS50b3AgKyBfaGVyby5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgICAgIF9oZWFkZXJCb3R0b21TZXQgPSBfb2JqLm9mZnNldCgpLnRvcCArIF9vYmoub3V0ZXJIZWlnaHQoKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIHZhciBfb25FdmVudCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgX3dpbmRvdy5vbiggJ3Njcm9sbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX2NoZWNrU2Nyb2xsKCk7XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NoZWNrU2Nyb2xsID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCBfaGVhZGVyQm90dG9tU2V0ICogNSA8IF93aW5kb3cuc2Nyb2xsVG9wKCkgJiYgX3dpbmRvdy5zY3JvbGxUb3AoKSA8IF9oZXJvQm90dG9tU2V0ICl7XG4gICAgICAgICAgICAgICAgICAgIF9oaWRlSGVhZGVyKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICggX3dpbmRvdy5zY3JvbGxUb3AoKSA+IF9oZXJvQm90dG9tU2V0ICkge1xuICAgICAgICAgICAgICAgICAgICBfZml4ZWRIZWFkZXIoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfaGVhZGVyT25Ub3AoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaGlkZUhlYWRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnaGlkZScgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZml4ZWRIZWFkZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ2ZpeGVkJyApO1xuICAgICAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdoaWRlJyApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oZWFkZXJPblRvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAnaGlkZScgKTtcbiAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAnZml4ZWQnICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgICAgIF9jaGVja1Njcm9sbCgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9pbml0KCk7XG4gICAgfTtcblxuICAgIHZhciBQbGFjZSA9IGZ1bmN0aW9uKCBvYmogKSB7XG5cbiAgICAgICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICAgICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgICAgICBfY3VyQ2l0eSA9IF9vYmouZmluZCggJy5wbGFjZV9fY3VycmVudCcgKSxcbiAgICAgICAgICAgIF9jaXRpZXNQb3B1cCA9IF9vYmouZmluZCggJy5wbGFjZV9fcG9wdXAnICksXG4gICAgICAgICAgICBfY2l0aWVzV3JhcCA9IF9jaXRpZXNQb3B1cC5maW5kKCAnLnBsYWNlX19jaXRpZXMnICksXG4gICAgICAgICAgICBfbGlzdENvdW50cmllcyA9IF9jaXRpZXNQb3B1cC5maW5kKCAnLnBsYWNlX19jb3VudHJpZXMnICksXG4gICAgICAgICAgICBfY291bnRyaWVzU2xpZGUgPSBfbGlzdENvdW50cmllcy5maW5kKCAnLnN3aXBlci1zbGlkZScgKSxcbiAgICAgICAgICAgIF9saXN0Q291bnRyeUl0ZW0gPSBfbGlzdENvdW50cmllcy5maW5kKCAnLnBsYWNlX19jb3VudHJpZXMtaXRlbScgKSxcbiAgICAgICAgICAgIF9jbG9zZVBvcHVwID0gX2NpdGllc1BvcHVwLmZpbmQoICcucGxhY2VfX3BvcHVwLWNsb3NlJyApLFxuICAgICAgICAgICAgX2JvZHkgPSAkKCAnYm9keScgKSxcbiAgICAgICAgICAgIF9zaXRlID0gJCggJy5zaXRlJyApLFxuICAgICAgICAgICAgX3NpdGVIZWFkID0gX3NpdGUuZmluZCggJy5zaXRlX19oZWFkZXInICksXG4gICAgICAgICAgICBfd2luZG93ID0gJCggd2luZG93ICksXG4gICAgICAgICAgICBfcG9zaXRpb24gPSAwLFxuICAgICAgICAgICAgX3N3aXBlckNvdW50cmllcyxcbiAgICAgICAgICAgIF9yZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICAgICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIF9vbkV2ZW50ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBfc2l0ZS5vbiggJ2NsaWNrJywgZnVuY3Rpb24gKCBlICkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIF9vYmouaGFzQ2xhc3MoICdzaG93JyApICYmICQoIGUudGFyZ2V0ICkuY2xvc2VzdCggX29iaiApLmxlbmd0aCA9PSAwICYmIF93aW5kb3cud2lkdGgoKSA8PSAxMjAwICl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfaGlkZVBvcHVwT25Nb2JpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIF9jdXJDaXR5Lm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCAhX3NpdGVIZWFkLmhhc0NsYXNzKCAnb3Blbi1tZW51JyApICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3Nob3dQb3B1cE9uTW9iaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIF9jbG9zZVBvcHVwLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF9oaWRlUG9wdXBPbk1vYmlsZSgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgX2xpc3RDb3VudHJ5SXRlbS5vbiggJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXRDb3VudHJ5ID0gJCggdGhpcyApO1xuXG4gICAgICAgICAgICAgICAgICAgIF9hamF4UmVxdWVzdCggY3V0Q291bnRyeSApO1xuXG4gICAgICAgICAgICAgICAgICAgIF9saXN0Q291bnRyeUl0ZW0ucmVtb3ZlQ2xhc3MoICdhY3RpdmUnICk7XG4gICAgICAgICAgICAgICAgICAgIGN1dENvdW50cnkuYWRkQ2xhc3MoICdhY3RpdmUnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9hamF4UmVxdWVzdCA9IGZ1bmN0aW9uKCBjb3VudHJ5T2JqICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGN1dENvdW50cnkgPSBjb3VudHJ5T2JqLFxuICAgICAgICAgICAgICAgICAgICBjdXRDb3VudHJ5SWQgPSBjdXRDb3VudHJ5LmRhdGEoICdjb3VudHJ5JyApO1xuXG4gICAgICAgICAgICAgICAgX3JlcXVlc3QgPSAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAncGhwL2NpdHkuZ2VvLnBocCcsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnlfaWQ6IGN1dENvdW50cnlJZFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnR0VUJyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCBkYXRhICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnN0cnVjdERhdGEoIGRhdGEgKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICggWE1MSHR0cFJlcXVlc3QgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIFhNTEh0dHBSZXF1ZXN0LnN0YXR1c1RleHQgIT0gXCJhYm9ydFwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnZXJyJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NoZWNrQWN0aXZlVGFiID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCBfbGlzdENvdW50cnlJdGVtLmZpbHRlciggJ2FjdGl2ZScgKS5sZW5ndGggPT0gMCApe1xuXG4gICAgICAgICAgICAgICAgICAgIF9saXN0Q291bnRyeUl0ZW0uZXEoIDAgKS50cmlnZ2VyKCAnY2xpY2snICk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY29uc3RydWN0RGF0YSA9IGZ1bmN0aW9uICggZGF0YSApIHtcblxuICAgICAgICAgICAgICAgIF9jaXRpZXNXcmFwLmVtcHR5KCk7XG5cbiAgICAgICAgICAgICAgICAkLmVhY2goIGRhdGEsIGZ1bmN0aW9uICggaSApIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdCA9ICQoICc8ZGw+PC9kbD4nICk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICggdmFyIG4gPSAwOyBuIDwgZGF0YS5sZW5ndGg7IG4rKyApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5hcHBlbmQoICc8ZHQ+JysgZGF0YVsgaSBdWyBuIF0uZ3JvdXAgKyc8L2R0PicgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpc3QuYXBwZW5kKCBfYXBwZW5kQ2l0aWVzKCBkYXRhWyBpIF1bIG4gXS5jaXR5ICkgKTtcblxuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIF9jaXRpZXNXcmFwLmFwcGVuZCggbGlzdCApO1xuXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2FwcGVuZENpdGllcyA9IGZ1bmN0aW9uICggZGF0YSApIHtcblxuICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gJCggJzxkZD48L2RkPicgKTtcblxuICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKysgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgbGlzdC5hcHBlbmQoICc8YSBocmVmPVwiJysgZGF0YVsgaSBdLmxpbmsgKydcIj4nKyBkYXRhWyBpIF0ubmFtZSAgKyc8L2E+JyApO1xuXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBsaXN0O1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldFNjcm9sbFdpZHRoID0gZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgdmFyIHNjcm9sbERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnKSxcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsQmFyV2lkdGg7XG5cbiAgICAgICAgICAgICAgICBzY3JvbGxEaXYuY2xhc3NOYW1lID0gJ3BsYWNlX19zY3JvbGxiYXItbWVhc3VyZSc7XG5cbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCBzY3JvbGxEaXYgKTtcblxuICAgICAgICAgICAgICAgIHNjcm9sbEJhcldpZHRoID0gc2Nyb2xsRGl2Lm9mZnNldFdpZHRoIC0gc2Nyb2xsRGl2LmNsaWVudFdpZHRoO1xuXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JvbGxEaXYpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjcm9sbEJhcldpZHRoO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zaG93UG9wdXBPbk1vYmlsZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9vYmouYWRkQ2xhc3MoICdzaG93JyApO1xuXG4gICAgICAgICAgICAgICAgX3Bvc2l0aW9uID0gX3dpbmRvdy5zY3JvbGxUb3AoKTtcblxuICAgICAgICAgICAgICAgIHZhciBoZWFkZXJSaWdodFBhZGRpbmcgPSArKCBfc2l0ZUhlYWQuY3NzKCAncGFkZGluZy1yaWdodCcgKS5yZXBsYWNlKCAncHgnLCAnJyApICksXG4gICAgICAgICAgICAgICAgICAgIGhlYWRlckxlZnRQYWRkaW5nID0gKyggX3NpdGVIZWFkLmNzcyggJ3BhZGRpbmctbGVmdCcgKS5yZXBsYWNlKCAncHgnLCAnJyApICk7XG5cbiAgICAgICAgICAgICAgICBfYm9keS5jc3MoICdvdmVyZmxvdy15JywgJ2hpZGRlbicgKTtcblxuICAgICAgICAgICAgICAgIF9zaXRlLmNzcygge1xuICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAncmVsYXRpdmUnLFxuICAgICAgICAgICAgICAgICAgICAndG9wJzogX3Bvc2l0aW9uICogLTFcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfc2l0ZUhlYWQuYWRkQ2xhc3MoICdvcGVuLW1lbnUnICk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF93aW5kb3cub3V0ZXJXaWR0aCgpID49IDc2OCApe1xuXG4gICAgICAgICAgICAgICAgICAgIF9zaXRlSGVhZC5jc3MoIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdwYWRkaW5nLWxlZnQnOiBoZWFkZXJMZWZ0UGFkZGluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdwYWRkaW5nLXJpZ2h0JzogaGVhZGVyUmlnaHRQYWRkaW5nICsgX2dldFNjcm9sbFdpZHRoKClcbiAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgICAgIF9jaXRpZXNQb3B1cC5jc3MoIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdwYWRkaW5nLWxlZnQnOiBoZWFkZXJMZWZ0UGFkZGluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdwYWRkaW5nLXJpZ2h0JzogaGVhZGVyUmlnaHRQYWRkaW5nICsgX2dldFNjcm9sbFdpZHRoKCkgKyAxN1xuICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICAgICAgX2Nsb3NlUG9wdXAuY3NzKCAncmlnaHQnLCBoZWFkZXJSaWdodFBhZGRpbmcgKyBfZ2V0U2Nyb2xsV2lkdGgoKSApO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgX2NpdGllc1dyYXAubmljZVNjcm9sbCgge1xuICAgICAgICAgICAgICAgICAgICBjdXJzb3Jjb2xvcjogXCIjMmYyZjJmXCIsXG4gICAgICAgICAgICAgICAgICAgIGN1cnNvcndpZHRoOiBcIjRweFwiLFxuICAgICAgICAgICAgICAgICAgICBjdXJzb3Jib3JkZXI6IFwiMFwiLFxuICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBcIiMxYTFhMWFcIixcbiAgICAgICAgICAgICAgICAgICAgYXV0b2hpZGVtb2RlOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oaWRlUG9wdXBPbk1vYmlsZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdzaG93JyApO1xuXG4gICAgICAgICAgICAgICAgX2JvZHkucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuICAgICAgICAgICAgICAgIF9zaXRlLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcbiAgICAgICAgICAgICAgICBfc2l0ZUhlYWQucmVtb3ZlQ2xhc3MoICdvcGVuLW1lbnUnICk7XG4gICAgICAgICAgICAgICAgX3NpdGVIZWFkLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBfcG9zaXRpb24gKVxuXG4gICAgICAgICAgICAgICAgX3dpbmRvdy5zY3JvbGxUb3AoIF9wb3NpdGlvbiApO1xuXG4gICAgICAgICAgICAgICAgX2NpdGllc1dyYXAubmljZVNjcm9sbCggJ2Rlc3Ryb3knICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaW5pdFNjaGVkdWxlU2Nyb2xsID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgaWYgKCBfY291bnRyaWVzU2xpZGUub3V0ZXJXaWR0aCgpID4gX2xpc3RDb3VudHJpZXMub3V0ZXJXaWR0aCgpICkge1xuXG4gICAgICAgICAgICAgICAgICAgIF9zd2lwZXJDb3VudHJpZXMgPSBuZXcgU3dpcGVyKCBfbGlzdENvdW50cmllcywge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiAnaG9yaXpvbnRhbCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgICAgICBmcmVlTW9kZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vdXNld2hlZWw6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgICAgIF9jaGVja0FjdGl2ZVRhYigpO1xuICAgICAgICAgICAgICAgIF9pbml0U2NoZWR1bGVTY3JvbGwoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgICAgIC8vcHVibGljIG1ldGhvZHNcblxuICAgICAgICBfaW5pdCgpO1xuICAgIH07XG5cbn0gKSgpOyIsIiggZnVuY3Rpb24oKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgJChmdW5jdGlvbigpe1xuXG4gICAgICAgICQuZWFjaCggJCggJy5oZXJvLCAuZ3JhdGl0dWRlJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5ldyBTbGlkZXJzICggJCggdGhpcyApICk7XG4gICAgICAgIH0gKTtcblxuICAgICAgICAkLmVhY2goICQoICcuc2NoZWR1bGVfX21vbnRoJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5ldyBTY2hlZHVsZSAoICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgJC5lYWNoKCAkKCAnLnN1YnNjcmliZScgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBuZXcgU3Vic2NyaWJlRm9ybSAoICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgJC5lYWNoKCAkKCAnLnBvcHVwX19hZGQnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IEFkZEZvcm0gKCAkKCB0aGlzICkgKTtcbiAgICAgICAgfSApO1xuXG4gICAgICAgICQuZWFjaCggJCggJy5wb3B1cF9fZXZlbnQnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IEV2ZW50Rm9ybSAoICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgJC5lYWNoKCAkKCAnLnBvcHVwX19oZWxwJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5ldyBIZWxwRm9ybSAoICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgJC5lYWNoKCAkKCAnLnBvcHVwX192b2x1bnRlZXInICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IFZvbHVudGVlckZvcm0gKCAkKCB0aGlzICkgKTtcbiAgICAgICAgfSApO1xuXG4gICAgfSk7XG5cbiAgICB2YXIgU2NoZWR1bGUgPSBmdW5jdGlvbiggb2JqICkge1xuXG4gICAgICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICAgICAgX25vdyA9IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBfY3VycmVudFllYXIgPSBfbm93LmdldEZ1bGxZZWFyKCksXG4gICAgICAgICAgICBfY3VycmVudE1vbnRoID0gX25vdy5nZXRNb250aCgpLFxuICAgICAgICAgICAgX29wdGlvbnMgPSB7IG1vbnRoOiAnbG9uZycgfSxcbiAgICAgICAgICAgIF9tb250aFRpdGxlID0gX29iai5maW5kKCAnLnNjaGVkdWxlX19tb250aC1uYW1lJyApLFxuICAgICAgICAgICAgX21vbnRoRGF5c1dyYXAgPSBfb2JqLmZpbmQoICcuc2NoZWR1bGVfX21vbnRoLWRheXMnICksXG4gICAgICAgICAgICBfbW9udGhEYXlzU2xpZGUgPSBfbW9udGhEYXlzV3JhcC5maW5kKCAnLnN3aXBlci1zbGlkZScgKSxcbiAgICAgICAgICAgIF9zY3JvbGxEYXlzID0gX21vbnRoRGF5c1dyYXAuZmluZCggJy5zY2hlZHVsZV9fbW9udGgtc2Nyb2xsYmFyJyApLFxuICAgICAgICAgICAgX3NjaGVkdWxlUGxhbiA9IF9vYmouZmluZCggJy5zY2hlZHVsZV9fcGxhbicgKSxcbiAgICAgICAgICAgIF9zY2hlZHVsZVBsYW5TbGlkZSA9IF9zY2hlZHVsZVBsYW4uZmluZCggJy5zY2hlZHVsZV9fcGxhbi1zbGlkZScgKSxcbiAgICAgICAgICAgIF9zY3JvbGxTY2hlZHVsZSA9IF9zY2hlZHVsZVBsYW4uZmluZCggJy5zY2hlZHVsZV9fcGxhbi1zY3JvbGxiYXInICksXG4gICAgICAgICAgICBfZGF0ZUJ0biwgX3N3aXBlclNjaGVkdWxlLCBfc3dpcGVyQ2FsZW5kYXIsXG4gICAgICAgICAgICBfd2luZG93ID0gJCggd2luZG93ICksXG4gICAgICAgICAgICBfcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIHZhciBfYWpheFJlcXVlc3QgPSBmdW5jdGlvbiggeWVhciwgbW9udGgsIGRhdGUgKSB7XG5cbiAgICAgICAgICAgICAgICBfcmVxdWVzdCA9ICQuYWpheCgge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICdwaHAvc2NoZWR1bGUucGhwJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgeWVhcjogeWVhcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoOiBtb250aCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGU6IGRhdGVcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ0dFVCcsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICggZGF0YSApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgX2xvYWREYXRhKCBkYXRhICk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICggWE1MSHR0cFJlcXVlc3QgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIFhNTEh0dHBSZXF1ZXN0LnN0YXR1c1RleHQgIT0gXCJhYm9ydFwiICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnZXJyJyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXRDYWxlbmRhclNjcm9sbCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9zd2lwZXJDYWxlbmRhciA9IG5ldyBTd2lwZXIoIF9tb250aERheXNXcmFwLCB7XG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbjogJ2hvcml6b250YWwnLFxuICAgICAgICAgICAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgIGZyZWVNb2RlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzY3JvbGxiYXI6IF9zY3JvbGxEYXlzLFxuICAgICAgICAgICAgICAgICAgICBtb3VzZXdoZWVsOiB0cnVlXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldExvY2FsRGF5ID0gZnVuY3Rpb24gKCBkYXRlICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGRheSA9IGRhdGUuZ2V0RGF5KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIGRheSA9PSAwICkge1xuICAgICAgICAgICAgICAgICAgICBkYXkgPSA3O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBkYXk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0TGFzdERheU9mTW9udGggPSBmdW5jdGlvbiAoIHllYXIsIG1vbnRoICkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoIHllYXIsIG1vbnRoICsgMSwgMCApO1xuICAgICAgICAgICAgICAgIHJldHVybiBkYXRlLmdldERhdGUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2V0Q2FsZW5kYXIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBfbW9udGhUaXRsZS50ZXh0KCBfbm93LnRvTG9jYWxlU3RyaW5nKCBcInJ1XCIsIF9vcHRpb25zICkgKTtcblxuICAgICAgICAgICAgICAgIGZvciAoIHZhciBpID0gMTsgaSA8PSBfZ2V0TGFzdERheU9mTW9udGgoIF9jdXJyZW50WWVhciwgX2N1cnJlbnRNb250aCApOyBpKysgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHdlZWtEYXkgPSAgX2dldExvY2FsRGF5KCBuZXcgRGF0ZSggX2N1cnJlbnRZZWFyLCBfY3VycmVudE1vbnRoLCBpICkgKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIHdlZWtEYXkgPT0gNiB8fCB3ZWVrRGF5ID09IDcgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfbW9udGhEYXlzU2xpZGUuYXBwZW5kKCAnPGEgaHJlZj1cIiNcIiBjbGFzcz1cIndlZWtlbmRcIj4nKyBpICsnPC9hPicgKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9tb250aERheXNTbGlkZS5hcHBlbmQoICc8YSBocmVmPVwiI1wiPicrIGkgKyc8L2E+JyApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfZGF0ZUJ0biA9IF9tb250aERheXNTbGlkZS5maW5kKCAnYScgKTtcblxuICAgICAgICAgICAgICAgIF9vbkV2ZW50KCk7XG5cbiAgICAgICAgICAgICAgICBfZGF0ZUJ0bi5lcSggX25vdy5nZXREYXRlKCkgKS5hZGRDbGFzcyggJ3RvZGF5JyApLnRyaWdnZXIoICdjbGljaycgKTtcblxuICAgICAgICAgICAgICAgIGlmICggX3dpbmRvdy5vdXRlcldpZHRoKCkgPCAxMTcwICl7XG5cbiAgICAgICAgICAgICAgICAgICAgX2luaXRDYWxlbmRhclNjcm9sbCgpO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2xvYWREYXRhID0gZnVuY3Rpb24gKCBkYXRhICkge1xuXG4gICAgICAgICAgICAgICAgX3NjaGVkdWxlUGxhblNsaWRlLmVtcHR5KCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9zd2lwZXJTY2hlZHVsZSAhPSB1bmRlZmluZWQgKXtcbiAgICAgICAgICAgICAgICAgICAgX3NjaGVkdWxlUGxhblsgMCBdLnN3aXBlci5kZXN0cm95KCBmYWxzZSwgdHJ1ZSApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBhcnIgPSBkYXRhLml0ZW1zLFxuICAgICAgICAgICAgICAgICAgICBudW1iZXIgPSBhcnIubGVuZ3RoO1xuXG4gICAgICAgICAgICAgICAgaWYgKCBudW1iZXIgPiAwICl7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgbnVtYmVyOyBpKysgKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgX3NjaGVkdWxlUGxhblNsaWRlLmFwcGVuZCggJzxhIGhyZWY9XCInKyBhcnJbaV0ubGluayArJ1wiIGNsYXNzPVwic2NoZWR1bGVfX3BsYW4taXRlbVwiPicrIGFycltpXS50aXRsZSArJzwvYT4nICk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfc2Nyb2xsU2NoZWR1bGUucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuICAgICAgICAgICAgICAgICAgICBfaW5pdFNjaGVkdWxlU2Nyb2xsKCk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIF9zY2hlZHVsZVBsYW5TbGlkZS5odG1sKCAnPGRpdiBjbGFzcz1cInNjaGVkdWxlX19wbGFuLWl0ZW0gZW1wdHlcIj7QodC10LPQvtC00L3RjyDRgdC+0LHRi9GC0LjQuSDQvdC10YI8L2Rpdj4nICk7XG4gICAgICAgICAgICAgICAgICAgIF9zY3JvbGxTY2hlZHVsZS5jc3MoICd2aXNpYmlsaXR5JywgJ2hpZGRlbicgKVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXRTY2hlZHVsZVNjcm9sbCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9zd2lwZXJTY2hlZHVsZSA9IG5ldyBTd2lwZXIoIF9zY2hlZHVsZVBsYW4sIHtcbiAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uOiAnaG9yaXpvbnRhbCcsXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlc1BlclZpZXc6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgZnJlZU1vZGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHNjcm9sbGJhcjogX3Njcm9sbFNjaGVkdWxlLFxuICAgICAgICAgICAgICAgICAgICBtb3VzZXdoZWVsOiB0cnVlXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uRXZlbnQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIF9kYXRlQnRuLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1ckVsZW0gPSAkKCB0aGlzICk7XG5cbiAgICAgICAgICAgICAgICAgICAgX2RhdGVCdG4ucmVtb3ZlQ2xhc3MoICdhY3RpdmUnICk7XG4gICAgICAgICAgICAgICAgICAgIGN1ckVsZW0uYWRkQ2xhc3MoICdhY3RpdmUnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgX2FqYXhSZXF1ZXN0KCBfY3VycmVudFllYXIsIF9jdXJyZW50TW9udGgsIGN1ckVsZW0udGV4dCgpICk7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfc2V0Q2FsZW5kYXIoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgICAgIC8vcHVibGljIG1ldGhvZHNcblxuICAgICAgICBfaW5pdCgpO1xuICAgIH07XG5cbiAgICB2YXIgU2xpZGVycyA9IGZ1bmN0aW9uKCBvYmogKSB7XG5cbiAgICAgICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICAgICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgICAgICBfaGVyb1NsaWRlciA9IF9vYmouZmluZCggJy5oZXJvX19zbGlkZXInICksXG4gICAgICAgICAgICBfZ3JhdGl0dWRlU2xpZGVyID0gX29iai5maW5kKCAnLmdyYXRpdHVkZV9fbGlzdCcgKSxcbiAgICAgICAgICAgIF9oZXJvU2xpZGUgPSBfaGVyb1NsaWRlci5maW5kKCAnLmhlcm9fX3NsaWRlJyApLFxuICAgICAgICAgICAgX2hlcm9QYWdpbmF0aW9uID0gX29iai5maW5kKCAnLmhlcm9fX3BhZ2luYXRpb24nICksXG4gICAgICAgICAgICBfZ3JhdGl0dWRlUGFnaW5hdGlvbiA9IF9vYmouZmluZCggJy5ncmF0aXR1ZGVfX3BhZ2luYXRpb24nICksXG4gICAgICAgICAgICBfaGVybyxcbiAgICAgICAgICAgIF9ncmF0aXR1ZGU7XG5cbiAgICAgICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIF9pbml0U2xpZGVyID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9oZXJvU2xpZGUubGVuZ3RoID4gMSApIHtcblxuICAgICAgICAgICAgICAgICAgICBfaGVybyA9IG5ldyBTd2lwZXIgKCBfaGVyb1NsaWRlciwge1xuICAgICAgICAgICAgICAgICAgICAgICAgZWZmZWN0OiAnc2xpZGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXV0b3BsYXk6IDI1MDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBzcGVlZDogNTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvb3A6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiBfaGVyb1BhZ2luYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uQ2xpY2thYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIF9ncmF0aXR1ZGUgPSBuZXcgU3dpcGVyICggX2dyYXRpdHVkZVNsaWRlciwge1xuICAgICAgICAgICAgICAgICAgICBlZmZlY3Q6ICdmYWRlJyxcbiAgICAgICAgICAgICAgICAgICAgYXV0b3BsYXk6IDIwMDAsXG4gICAgICAgICAgICAgICAgICAgIHNwZWVkOiA1MDAsXG4gICAgICAgICAgICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgICAgICAgICAgICAgICAgIGxvb3A6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IF9ncmF0aXR1ZGVQYWdpbmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICBwYWdpbmF0aW9uQ2xpY2thYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfaW5pdFNsaWRlcigpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9pbml0KCk7XG4gICAgfTtcblxuICAgIHZhciBTdWJzY3JpYmVGb3JtID0gZnVuY3Rpb24oIG9iaiApe1xuXG4gICAgICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICAgICAgX2VtYWlsRmllbGRlciA9IF9vYmouZmluZCggJ2lucHV0W3R5cGU9ZW1haWxdJyApLFxuICAgICAgICAgICAgX2J0biA9IF9vYmouZmluZCggJ2J1dHRvbicgKSxcbiAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZSA9IF9vYmouZmluZCggJy5zdWJzY3JpYmVfX3N1Y2Nlc3MnICksXG4gICAgICAgICAgICBfdmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKCBfb2JqICk7XG5cbiAgICAgICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIF9pbml0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkV2ZW50ID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIF9vYmoub24oICdzdWJtaXQnLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfdmFsaWRhdGlvbi52YWxpZCA9PSB0cnVlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2FqYXhTZW5kKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYWpheFNlbmQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3BocC9zZW5kZXIucGhwJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdodG1sJyxcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogMjAwMDAsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogX2VtYWlsRmllbGRlci52YWwoKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9zaG93U3VjY2Vzc01lc3NhZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKFhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSAnYWJvcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3dTdWNjZXNzTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZS5hZGRDbGFzcyggJ3Nob3cnICk7XG5cbiAgICAgICAgICAgICAgICBfb2JqWzBdLnJlc2V0KCk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZS5yZW1vdmVDbGFzcyggJ3Nob3cnICk7XG4gICAgICAgICAgICAgICAgfSwgNDAwMCApO1xuXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIHByb3BlcnRpZXNcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG5cbiAgICAgICAgX2luaXQoKTtcblxuICAgIH07XG5cbiAgICB2YXIgQWRkRm9ybSA9IGZ1bmN0aW9uKCBvYmogKXtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9lbWFpbEZpZWxkZXIgPSBfb2JqLmZpbmQoICdpbnB1dFt0eXBlPWVtYWlsXScgKSxcbiAgICAgICAgICAgIF91cmxGaWVsZGVyID0gX29iai5maW5kKCAnaW5wdXRbdHlwZT10ZXh0XScgKSxcbiAgICAgICAgICAgIF9tZXNzYWdlRmllbGRlciA9IF9vYmouZmluZCggJ3RleHRhcmVhJyApLFxuICAgICAgICAgICAgX2J0biA9IF9vYmouZmluZCggJ2J1dHRvbicgKSxcbiAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZSA9IF9vYmouZmluZCggJy5wb3B1cF9fc3VjY2VzcycgKSxcbiAgICAgICAgICAgIF92YWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoIF9vYmogKTtcblxuICAgICAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgX2luaXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uRXZlbnQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgX29iai5vbiggJ3N1Ym1pdCcsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIF92YWxpZGF0aW9uLnZhbGlkID09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYWpheFNlbmQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9hamF4U2VuZCA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAncGhwL3NlbmRlci5waHAnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiAyMDAwMCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiBfZW1haWxGaWVsZGVyLnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsRmllbGRlci52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IF9tZXNzYWdlRmllbGRlci52YWwoKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9zaG93U3VjY2Vzc01lc3NhZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKFhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSAnYWJvcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3dTdWNjZXNzTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZS5hZGRDbGFzcyggJ3Nob3cnICk7XG5cbiAgICAgICAgICAgICAgICBfb2JqWzBdLnJlc2V0KCk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICQoICcucG9wdXAnIClbMF0ub2JqLmNsb3NlKDApO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZS5yZW1vdmVDbGFzcygnc2hvdycpO1xuICAgICAgICAgICAgICAgICAgICB9LCAzMDAgKTtcblxuICAgICAgICAgICAgICAgIH0sIDIwMDAgKTtcblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9pbml0KCk7XG5cbiAgICB9O1xuXG4gICAgdmFyIEV2ZW50Rm9ybSA9IGZ1bmN0aW9uKCBvYmogKXtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9lbWFpbEZpZWxkZXIgPSBfb2JqLmZpbmQoICdpbnB1dFt0eXBlPWVtYWlsXScgKSxcbiAgICAgICAgICAgIF91cmxGaWVsZGVyID0gX29iai5maW5kKCAnaW5wdXRbdHlwZT10ZXh0XScgKSxcbiAgICAgICAgICAgIF9tZXNzYWdlRmllbGRlciA9IF9vYmouZmluZCggJ3RleHRhcmVhJyApLFxuICAgICAgICAgICAgX2J0biA9IF9vYmouZmluZCggJ2J1dHRvbicgKSxcbiAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZSA9IF9vYmouZmluZCggJy5wb3B1cF9fc3VjY2VzcycgKSxcbiAgICAgICAgICAgIF92YWxpZGF0aW9uID0gbmV3IEZvcm1WYWxpZGF0b3IoIF9vYmogKTtcblxuICAgICAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgX2luaXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uRXZlbnQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgX29iai5vbiggJ3N1Ym1pdCcsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIF92YWxpZGF0aW9uLnZhbGlkID09IHRydWUgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfYWpheFNlbmQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9hamF4U2VuZCA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICAkLmFqYXgoIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAncGhwL3NlbmRlci5waHAnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2h0bWwnLFxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0OiAyMDAwMCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiBfZW1haWxGaWVsZGVyLnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFsY2U6IF91cmxGaWVsZGVyLnZhbCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogX21lc3NhZ2VGaWVsZGVyLnZhbCgpXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgX3Nob3dTdWNjZXNzTWVzc2FnZSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoWE1MSHR0cFJlcXVlc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0ICE9ICdhYm9ydCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChYTUxIdHRwUmVxdWVzdC5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2hvd1N1Y2Nlc3NNZXNzYWdlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgX3N1Y2Nlc3NNZXNzYWdlLmFkZENsYXNzKCAnc2hvdycgKTtcblxuICAgICAgICAgICAgICAgIF9vYmpbMF0ucmVzZXQoKTtcblxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCggJy5wb3B1cCcgKVswXS5vYmouY2xvc2UoMCk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCggZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3N1Y2Nlc3NNZXNzYWdlLnJlbW92ZUNsYXNzKCdzaG93Jyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMCApO1xuXG4gICAgICAgICAgICAgICAgfSwgMjAwMCApO1xuXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIHByb3BlcnRpZXNcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG5cbiAgICAgICAgX2luaXQoKTtcblxuICAgIH07XG5cbiAgICB2YXIgSGVscEZvcm0gPSBmdW5jdGlvbiggb2JqICl7XG5cbiAgICAgICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICAgICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgICAgICBfZW1haWxGaWVsZGVyID0gX29iai5maW5kKCAnaW5wdXRbdHlwZT1lbWFpbF0nICksXG4gICAgICAgICAgICBfdXJsRmllbGRlciA9IF9vYmouZmluZCggJ2lucHV0W3R5cGU9dGV4dF0nICksXG4gICAgICAgICAgICBfbWVzc2FnZUZpZWxkZXIgPSBfb2JqLmZpbmQoICd0ZXh0YXJlYScgKSxcbiAgICAgICAgICAgIF9idG4gPSBfb2JqLmZpbmQoICdidXR0b24nICksXG4gICAgICAgICAgICBfc3VjY2Vzc01lc3NhZ2UgPSBfb2JqLmZpbmQoICcucG9wdXBfX3N1Y2Nlc3MnICksXG4gICAgICAgICAgICBfdmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKCBfb2JqICk7XG5cbiAgICAgICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIF9pbml0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkV2ZW50ID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIF9vYmoub24oICdzdWJtaXQnLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfdmFsaWRhdGlvbi52YWxpZCA9PSB0cnVlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2FqYXhTZW5kKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYWpheFNlbmQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3BocC9zZW5kZXIucGhwJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdodG1sJyxcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogMjAwMDAsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogX2VtYWlsRmllbGRlci52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhbGNlOiBfdXJsRmllbGRlci52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IF9tZXNzYWdlRmllbGRlci52YWwoKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9zaG93U3VjY2Vzc01lc3NhZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKFhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSAnYWJvcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3dTdWNjZXNzTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZS5hZGRDbGFzcyggJ3Nob3cnICk7XG5cbiAgICAgICAgICAgICAgICBfb2JqWzBdLnJlc2V0KCk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICQoICcucG9wdXAnIClbMF0ub2JqLmNsb3NlKDApO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZS5yZW1vdmVDbGFzcygnc2hvdycpO1xuICAgICAgICAgICAgICAgICAgICB9LCAzMDAgKTtcblxuICAgICAgICAgICAgICAgIH0sIDIwMDAgKTtcblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9pbml0KCk7XG5cbiAgICB9O1xuXG4gICAgdmFyIFZvbHVudGVlckZvcm0gPSBmdW5jdGlvbiggb2JqICl7XG5cbiAgICAgICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICAgICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgICAgICBfZW1haWxGaWVsZGVyID0gX29iai5maW5kKCAnaW5wdXRbdHlwZT1lbWFpbF0nICksXG4gICAgICAgICAgICBfdXJsRmllbGRlciA9IF9vYmouZmluZCggJ2lucHV0W3R5cGU9dGV4dF0nICksXG4gICAgICAgICAgICBfbWVzc2FnZUZpZWxkZXIgPSBfb2JqLmZpbmQoICd0ZXh0YXJlYScgKSxcbiAgICAgICAgICAgIF9idG4gPSBfb2JqLmZpbmQoICdidXR0b24nICksXG4gICAgICAgICAgICBfc3VjY2Vzc01lc3NhZ2UgPSBfb2JqLmZpbmQoICcucG9wdXBfX3N1Y2Nlc3MnICksXG4gICAgICAgICAgICBfdmFsaWRhdGlvbiA9IG5ldyBGb3JtVmFsaWRhdG9yKCBfb2JqICk7XG5cbiAgICAgICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIF9pbml0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkV2ZW50ID0gZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIF9vYmoub24oICdzdWJtaXQnLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfdmFsaWRhdGlvbi52YWxpZCA9PSB0cnVlICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2FqYXhTZW5kKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYWpheFNlbmQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgJC5hamF4KCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogJ3BocC9zZW5kZXIucGhwJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdodG1sJyxcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogMjAwMDAsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbWFpbDogX2VtYWlsRmllbGRlci52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhbGNlOiBfdXJsRmllbGRlci52YWwoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IF9tZXNzYWdlRmllbGRlci52YWwoKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIF9zaG93U3VjY2Vzc01lc3NhZ2UoKTtcblxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKFhNTEh0dHBSZXF1ZXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSAnYWJvcnQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3dTdWNjZXNzTWVzc2FnZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZS5hZGRDbGFzcyggJ3Nob3cnICk7XG5cbiAgICAgICAgICAgICAgICBfb2JqWzBdLnJlc2V0KCk7XG5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICQoICcucG9wdXAnIClbMF0ub2JqLmNsb3NlKDApO1xuXG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zdWNjZXNzTWVzc2FnZS5yZW1vdmVDbGFzcygnc2hvdycpO1xuICAgICAgICAgICAgICAgICAgICB9LCAzMDAgKTtcblxuICAgICAgICAgICAgICAgIH0sIDIwMDAgKTtcblxuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9pbml0KCk7XG5cbiAgICB9O1xuXG59ICkoKTsiLCJ2YXIgRm9ybVZhbGlkYXRvciA9IGZ1bmN0aW9uIChvYmopIHtcblxuICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgdmFyIF9vYmogPSBvYmosXG4gICAgICAgIF9zZWxmID0gdGhpcyxcbiAgICAgICAgX2lucHV0cyA9IF9vYmouZmluZCggJ2lucHV0LCB0ZXh0YXJlYScgKSxcbiAgICAgICAgX2ZpZWxkcyA9IF9vYmouZmluZCggJ1tkYXRhLXJlcXVpcmVkXScgKSxcbiAgICAgICAgX2NoZWNrYm94ID0gX29iai5maW5kKCAnaW5wdXRbdHlwZT1jaGVja2JveF0nICk7XG5cbiAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgIHZhciBfaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF9vbkV2ZW50cygpO1xuICAgICAgICAgICAgX29ialsgMCBdLm9iaiA9IF9zZWxmO1xuICAgICAgICB9LFxuICAgICAgICBfYWRkTm90VG91Y2hlZENsYXNzID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBfZmllbGRzLmVhY2goIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgaWYoIGN1ckl0ZW0udmFsKCkgPT09ICcnIHx8ICFjdXJJdGVtLmlzKCAnOmNoZWNrZWQnICkgKXtcblxuICAgICAgICAgICAgICAgICAgICBjdXJJdGVtLmFkZENsYXNzKCAnbm90LXRvdWNoZWQnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgX3ZhbGlkYXRlRmllbGQoIGN1ckl0ZW0gKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICggY3VySXRlbS5oYXNDbGFzcyggJ3ZhbGlkJyApICl7XG4gICAgICAgICAgICAgICAgICAgIGN1ckl0ZW0ucmVtb3ZlQ2xhc3MoICdub3QtdG91Y2hlZCcgKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gKTtcblxuICAgICAgICB9LFxuICAgICAgICBfb25FdmVudHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBfZmllbGRzLm9uKCB7XG4gICAgICAgICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICQoIHRoaXMgKS5yZW1vdmVDbGFzcyggJ25vdC10b3VjaGVkJyApO1xuXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmb2N1c291dDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIF92YWxpZGF0ZUZpZWxkKCBjdXJJdGVtICk7XG5cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGtleXVwOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSAkKHRoaXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICggY3VySXRlbS5oYXNDbGFzcyggJ25vdC12YWxpZCcgKSApe1xuICAgICAgICAgICAgICAgICAgICAgICAgX3ZhbGlkYXRlRmllbGQoIGN1ckl0ZW0gKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgX2lucHV0cy5vbigge1xuICAgICAgICAgICAgICAgIGZvY3Vzb3V0OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgbGV0dGVyQ291bnRlciA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgX2lucHV0cy5lYWNoKCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJJdGVtID0gJCh0aGlzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCBjdXJJdGVtLnZhbCgpLmxlbmd0aCA+IDAgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXR0ZXJDb3VudGVyID0gbGV0dGVyQ291bnRlciArIDFcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBsZXR0ZXJDb3VudGVyID09PSAwICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2lucHV0cy5yZW1vdmVDbGFzcyggJ25vdC12YWxpZCcgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zZWxmLnZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgIF9vYmoub24oIHtcbiAgICAgICAgICAgICAgICBzdWJtaXQ6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIF9hZGROb3RUb3VjaGVkQ2xhc3MoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiggIShfZmllbGRzLmZpbHRlciggJy5ub3QtdmFsaWQnICkubGVuZ3RoID09PSAwKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zZWxmLnZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiggX2ZpZWxkcy5oYXNDbGFzcyggJ25vdC10b3VjaGVkJyApIHx8IF9maWVsZHMuaGFzQ2xhc3MoICdub3QtdmFsaWQnICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfb2JqLmZpbmQoJy5ub3QtdG91Y2hlZDpmaXJzdCcpLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfb2JqLmZpbmQoJy5ub3QtdmFsaWQ6Zmlyc3QnKS5mb2N1cygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3NlbGYudmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgIF9jaGVja2JveC5vbiggJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICQoIHRoaXMgKS5yZW1vdmVDbGFzcyggJ25vdC12YWxpZCBub3QtdG91Y2hlZCcgKTtcblxuICAgICAgICAgICAgfSApO1xuICAgICAgICB9LFxuICAgICAgICBfbWFrZU5vdFZhbGlkID0gZnVuY3Rpb24gKCBmaWVsZCApIHtcbiAgICAgICAgICAgIGZpZWxkLmFkZENsYXNzKCAnbm90LXZhbGlkJyApO1xuICAgICAgICAgICAgZmllbGQucmVtb3ZlQ2xhc3MoICd2YWxpZCcgKTtcbiAgICAgICAgfSxcbiAgICAgICAgX21ha2VWYWxpZCA9IGZ1bmN0aW9uICggZmllbGQgKSB7XG4gICAgICAgICAgICBmaWVsZC5yZW1vdmVDbGFzcyggJ25vdC12YWxpZCcgKTtcbiAgICAgICAgICAgIGZpZWxkLmFkZENsYXNzKCAndmFsaWQnICk7XG4gICAgICAgIH0sXG4gICAgICAgIF92YWxpZGF0ZUVtYWlsID0gZnVuY3Rpb24gKCBlbWFpbCApIHtcbiAgICAgICAgICAgIHZhciByZSA9IC9eKChbXjw+KClcXFtcXF1cXFxcLiw7Olxcc0BcIl0rKFxcLltePD4oKVxcW1xcXVxcXFwuLDs6XFxzQFwiXSspKil8KFwiLitcIikpQCgoXFxbWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XFwuWzAtOV17MSwzfV0pfCgoW2EtekEtWlxcLTAtOV0rXFwuKStbYS16QS1aXXsyLH0pKSQvO1xuICAgICAgICAgICAgcmV0dXJuIHJlLnRlc3QoZW1haWwpO1xuICAgICAgICB9LFxuICAgICAgICBfdmFsaWRhdGVGaWVsZCA9IGZ1bmN0aW9uICggZmllbGQgKSB7XG5cbiAgICAgICAgICAgIHZhciB0eXBlID0gZmllbGQuYXR0ciggJ3R5cGUnICksXG4gICAgICAgICAgICAgICAgdGFnTmFtZSA9IGZpZWxkWzBdLnRhZ05hbWU7XG5cbiAgICAgICAgICAgIGlmKCB0eXBlID09PSAnZW1haWwnIHx8IHR5cGUgPT09ICd0ZXh0JyAgfHwgdHlwZSA9PT0gJ3RlbCcgKXtcblxuICAgICAgICAgICAgICAgIGlmKCBmaWVsZC52YWwoKSA9PT0gJycgKXtcbiAgICAgICAgICAgICAgICAgICAgX21ha2VOb3RWYWxpZCggZmllbGQgKTtcbiAgICAgICAgICAgICAgICAgICAgX3NlbGYudmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiggdHlwZSA9PT0gJ2VtYWlsJyApe1xuICAgICAgICAgICAgICAgIGlmKCAhX3ZhbGlkYXRlRW1haWwoIGZpZWxkLnZhbCgpICkgKXtcbiAgICAgICAgICAgICAgICAgICAgX21ha2VOb3RWYWxpZCggZmllbGQgKTtcbiAgICAgICAgICAgICAgICAgICAgX3NlbGYudmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoIHR5cGUgPT09ICdjaGVja2JveCcgKXtcblxuICAgICAgICAgICAgICAgIGlmKCAhZmllbGQuaXMoICc6Y2hlY2tlZCcgKSApe1xuICAgICAgICAgICAgICAgICAgICBfbWFrZU5vdFZhbGlkKCBmaWVsZCApO1xuICAgICAgICAgICAgICAgICAgICBfc2VsZi52YWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKCB0YWdOYW1lLnRvTG9jYWxlTG93ZXJDYXNlKCkgPT0gJ3RleHRhcmVhJyApe1xuXG4gICAgICAgICAgICAgICAgaWYoIGZpZWxkLnZhbCgpID09PSAnJyApe1xuICAgICAgICAgICAgICAgICAgICBfbWFrZU5vdFZhbGlkKCBmaWVsZCApO1xuICAgICAgICAgICAgICAgICAgICBfc2VsZi52YWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF9tYWtlVmFsaWQoIGZpZWxkICk7XG5cbiAgICAgICAgICAgIGlmKCBfZmllbGRzLmZpbHRlciggJy5ub3QtdmFsaWQnICkubGVuZ3RoID09PSAwICkge1xuXG4gICAgICAgICAgICAgICAgX3NlbGYudmFsaWQgPSB0cnVlO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfTtcblxuICAgIC8vcHVibGljIHByb3BlcnRpZXNcbiAgICBfc2VsZi52YWxpZCA9IGZhbHNlO1xuXG4gICAgX2luaXQoKTtcbn07IiwiKCBmdW5jdGlvbigpe1xuXG4gICAgJCggZnVuY3Rpb24oKXtcblxuICAgICAgICAkKCAnLnBvcHVwJyApLmVhY2goZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgbmV3IFBvcHVwKCQodGhpcykpO1xuXG4gICAgICAgIH0pO1xuXG4gICAgfSk7XG5cbiAgICB2YXIgUG9wdXAgPSBmdW5jdGlvbiggb2JqICl7XG5cbiAgICAgICAgLy9wcml2YXRlIHByb3BlcnRpZXNcbiAgICAgICAgdmFyIF9zZWxmID0gdGhpcyxcbiAgICAgICAgICAgIF9idG5TaG93ID0gICQoICcucG9wdXBfX29wZW4nICksXG4gICAgICAgICAgICBfb2JqID0gb2JqLFxuICAgICAgICAgICAgX2J0bkNsb3NlID0gX29iai5maW5kKCAnLnBvcHVwX19jbG9zZSwgLnBvcHVwX19jYW5jZWwnICksXG4gICAgICAgICAgICBfd3JhcCA9IF9vYmouZmluZCggJy5wb3B1cF9fd3JhcCcgKSxcbiAgICAgICAgICAgIF9jb250ZW50cyA9IF9vYmouZmluZCggJy5wb3B1cF9fY29udGVudCcgKSxcbiAgICAgICAgICAgIF9zY3JvbGxDb250ZWluZXIgPSAkKCAnaHRtbCcgKSxcbiAgICAgICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKSxcbiAgICAgICAgICAgIF90aW1lciA9IHNldFRpbWVvdXQoIGZ1bmN0aW9uKCl7fSwgMSApO1xuXG4gICAgICAgIC8vcHJpdmF0ZSBtZXRob2RzXG4gICAgICAgIHZhciBfY2VudGVyV3JhcCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYgKCBfd3JhcC5vdXRlckhlaWdodCgpIDwgX3dpbmRvdy5vdXRlckhlaWdodCgpICYmIF93aW5kb3cub3V0ZXJXaWR0aCgpID49IDc2OCApIHtcbiAgICAgICAgICAgICAgICAgICAgX3dyYXAuY3NzKCB7IHRvcDogKCBfd2luZG93Lm91dGVySGVpZ2h0KCkgLSBfd3JhcC5vdXRlckhlaWdodCgpICkgLyAyIH0gKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBfd3JhcC5jc3MoIHsgdG9wOiAwIH0gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2dldFNjcm9sbFdpZHRoID0gZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgdmFyIHNjcm9sbERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICdkaXYnKSxcbiAgICAgICAgICAgICAgICAgICAgc2Nyb2xsQmFyV2lkdGg7XG5cbiAgICAgICAgICAgICAgICBzY3JvbGxEaXYuY2xhc3NOYW1lID0gJ3BvcHVwX19zY3JvbGxiYXItbWVhc3VyZSc7XG5cbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCBzY3JvbGxEaXYgKTtcblxuICAgICAgICAgICAgICAgIHNjcm9sbEJhcldpZHRoID0gc2Nyb2xsRGl2Lm9mZnNldFdpZHRoIC0gc2Nyb2xsRGl2LmNsaWVudFdpZHRoO1xuXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChzY3JvbGxEaXYpO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHNjcm9sbEJhcldpZHRoO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oaWRlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBfb2JqLmNzcygge1xuICAgICAgICAgICAgICAgICAgICBvdmVyZmxvd1k6ICdoaWRkZW4nXG4gICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgICAgIF9zY3JvbGxDb250ZWluZXIuY3NzKCB7XG4gICAgICAgICAgICAgICAgICAgIG92ZXJmbG93WTogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nUmlnaHQ6IDBcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAncG9wdXBfb3BlbmVkJyApO1xuICAgICAgICAgICAgICAgIF9vYmouYWRkQ2xhc3MoICdwb3B1cF9oaWRlJyApO1xuXG4gICAgICAgICAgICAgICAgX3RpbWVyID0gc2V0VGltZW91dCggZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgICAgICBfb2JqLmNzcyAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3dZOiAnYXV0bydcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgX29iai5yZW1vdmVDbGFzcyggJ3BvcHVwX2hpZGUnICk7XG4gICAgICAgICAgICAgICAgfSwgMzAwICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaW5pdCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgX29ialsgMCBdLm9iaiA9IF9zZWxmO1xuICAgICAgICAgICAgICAgIF9vbkV2ZW50cygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9vbkV2ZW50cyA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgX3dpbmRvdy5vbigge1xuICAgICAgICAgICAgICAgICAgICByZXNpemU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY2VudGVyV3JhcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgICAgIF9idG5TaG93Lm9uKCB7XG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgX3Nob3coICQoIHRoaXMgKS5hdHRyKCAnZGF0YS1wb3B1cCcgKSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgICAgIF93cmFwLm9uKCB7XG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbiggZSApe1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgICAgICBfb2JqLm9uKCB7XG4gICAgICAgICAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgX2hpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgICAgICBfYnRuQ2xvc2Uub24oIHtcbiAgICAgICAgICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9zaG93ID0gZnVuY3Rpb24oIGNsYXNzTmFtZSApe1xuICAgICAgICAgICAgICAgIF9zZXRQb3B1cENvbnRlbnQoIGNsYXNzTmFtZSApO1xuXG4gICAgICAgICAgICAgICAgX3Njcm9sbENvbnRlaW5lci5jc3MoIHtcbiAgICAgICAgICAgICAgICAgICAgb3ZlcmZsb3dZOiAnaGlkZGVuJyxcbiAgICAgICAgICAgICAgICAgICAgcGFkZGluZ1JpZ2h0OiBfZ2V0U2Nyb2xsV2lkdGgoKVxuICAgICAgICAgICAgICAgIH0gKTtcbiAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAncG9wdXBfb3BlbmVkJyApO1xuICAgICAgICAgICAgICAgIF9jZW50ZXJXcmFwKCk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfc2V0UG9wdXBDb250ZW50ID0gZnVuY3Rpb24oIGNsYXNzTmFtZSApe1xuICAgICAgICAgICAgICAgIHZhciBjdXJDb250ZW50ID0gX2NvbnRlbnRzLmZpbHRlciggJy5wb3B1cF9fJyArIGNsYXNzTmFtZSApO1xuXG4gICAgICAgICAgICAgICAgX2NvbnRlbnRzLmNzcyggeyBkaXNwbGF5OiAnbm9uZScgfSApO1xuICAgICAgICAgICAgICAgIGN1ckNvbnRlbnQuY3NzKCB7IGRpc3BsYXk6ICdibG9jaycgfSApO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuICAgICAgICBfc2VsZi5jbG9zZSA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBfaGlkZSgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIF9pbml0KCk7XG4gICAgfTtcblxufSApKCk7XG5cbiJdfQ==

( function(){

    "use strict";

    $(function(){

        $.each( $( '.menu' ), function() {
            new Menu ( $( this ) );
        } );

        $.each( $( '.site__header' ), function() {
            new Header ( $( this ) );
        } );

        $.each( $( '.place' ), function() {
            new Place ( $( this ) );
        } );

    } );

    var Menu = function( obj ) {

        //private properties
        var _obj = obj,
            _mobileBtn = $( '.menu-mobile-btn' ),
            _closeBtn = _obj.find( '.menu-close-btn' ),
            _body = $( 'body' ),
            _site = _body.find( '.site' ),
            _siteHead = _site.find( '.site__header' ),
            _window = $( window ),
            _position = 0;

        //private methods
        var _onEvent = function() {

                _mobileBtn.on( 'click', function () {
                    _showMobileMenu();
                    return false;
                } );

                _closeBtn.on( 'click', function () {
                    _hideMobileMenu();
                    return false;
                } );

            },
            _hideMobileMenu = function () {

                _obj.removeClass( 'show' );

                _body.removeAttr( 'style' );
                _site.removeAttr( 'style' );
                _siteHead.removeClass( 'open-menu' );

                _window.scrollTop( _position );

            },
            _showMobileMenu = function () {

                _obj.addClass( 'show' );

                _position = _window.scrollTop();

                _body.css( 'overflow-y', 'hidden' );

                _site.css( {
                    'position': 'relative',
                    'top': _position * -1
                } );

                _siteHead.addClass( 'open-menu' );

            },
            _init = function() {
                _onEvent();
            };

        //public properties

        //public methods

        _init();
    };

    var Header = function( obj ) {

        //private properties
        var _obj = obj,
            _hero = $( '.hero' ),
            _heroBottomSet = 0,
            _headerBottomSet = 0,
            _window = $( window );

            if ( _hero.length > 0 ){

                _heroBottomSet = _hero.offset().top + _hero.outerHeight();
                _headerBottomSet = _obj.offset().top + _obj.outerHeight();

            }

        //private methods
        var _onEvent = function() {

                _window.on( 'scroll', function () {
                    _checkScroll();
                } );

            },
            _checkScroll = function () {

                if ( _headerBottomSet * 5 < _window.scrollTop() && _window.scrollTop() < _heroBottomSet ){
                    _hideHeader();
                } else if ( _window.scrollTop() > _heroBottomSet ) {
                    _fixedHeader();
                } else {
                    _headerOnTop();
                }

            },
            _hideHeader = function () {
                _obj.addClass( 'hide' );
            },
            _fixedHeader = function () {
                _obj.addClass( 'fixed' );
                _obj.removeClass( 'hide' );
            },
            _headerOnTop = function () {
                _obj.removeClass( 'hide' );
                _obj.removeClass( 'fixed' );
            },
            _init = function() {
                _onEvent();
                _checkScroll();
            };

        //public properties

        //public methods

        _init();
    };

    var Place = function( obj ) {

        //private properties
        var _obj = obj,
            _curCity = _obj.find( '.place__current' ),
            _citiesPopup = _obj.find( '.place__popup' ),
            _citiesWrap = _citiesPopup.find( '.place__cities' ),
            _listCountries = _citiesPopup.find( '.place__countries' ),
            _countriesSlide = _listCountries.find( '.swiper-slide' ),
            _listCountryItem = _listCountries.find( '.place__countries-item' ),
            _closePopup = _citiesPopup.find( '.place__popup-close' ),
            _body = $( 'body' ),
            _site = $( '.site' ),
            _siteHead = _site.find( '.site__header' ),
            _window = $( window ),
            _position = 0,
            _swiperCountries,
            _request = new XMLHttpRequest();

        //private methods
        var _onEvent = function() {

                _site.on( 'click', function ( e ) {
                    if ( _obj.hasClass( 'show' ) && $( e.target ).closest( _obj ).length == 0 && _window.width() <= 1200 ){
                        _hidePopupOnMobile();
                    }
                } );

                _curCity.on( 'click', function () {

                    if ( !_siteHead.hasClass( 'open-menu' ) ) {
                        _showPopupOnMobile();
                    }

                } );

                _closePopup.on( 'click', function () {
                    _hidePopupOnMobile();
                    return false;
                } );

                _listCountryItem.on( 'click', function () {

                    var cutCountry = $( this );

                    _ajaxRequest( cutCountry );

                    _listCountryItem.removeClass( 'active' );
                    cutCountry.addClass( 'active' );

                    return false;
                } );

            },
            _ajaxRequest = function( countryObj ) {

                var cutCountry = countryObj,
                    cutCountryId = cutCountry.data( 'country' );

                _request = $.ajax( {
                    url: 'php/city.geo.php',
                    data: {
                        country_id: cutCountryId
                    },
                    dataType: 'json',
                    type: 'GET',
                    success: function ( data ) {
                        _constructData( data );
                    },
                    error: function ( XMLHttpRequest ) {
                        if ( XMLHttpRequest.statusText != "abort" ) {
                            console.log( 'err' );
                        }
                    }
                } );

            },
            _checkActiveTab = function () {

                if ( _listCountryItem.filter( 'active' ).length == 0 ){

                    _listCountryItem.eq( 0 ).trigger( 'click' );

                }

            },
            _constructData = function ( data ) {

                _citiesWrap.empty();

                $.each( data, function ( i ) {

                    var list = $( '<dl></dl>' );

                    for ( var n = 0; n < data.length; n++ ) {

                        list.append( '<dt>'+ data[ i ][ n ].group +'</dt>' );
                        list.append( _appendCities( data[ i ][ n ].city ) );

                    };

                    _citiesWrap.append( list );

                } );

            },
            _appendCities = function ( data ) {

                var list = $( '<dd></dd>' );

                for ( var i = 0; i < data.length; i++ ) {

                    list.append( '<a href="'+ data[ i ].link +'">'+ data[ i ].name  +'</a>' );

                };

                return list;

            },
            _getScrollWidth = function (){
                var scrollDiv = document.createElement( 'div'),
                    scrollBarWidth;

                scrollDiv.className = 'place__scrollbar-measure';

                document.body.appendChild( scrollDiv );

                scrollBarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;

                document.body.removeChild(scrollDiv);

                return scrollBarWidth;
            },
            _showPopupOnMobile = function () {

                _obj.addClass( 'show' );

                _position = _window.scrollTop();

                var headerRightPadding = +( _siteHead.css( 'padding-right' ).replace( 'px', '' ) ),
                    headerLeftPadding = +( _siteHead.css( 'padding-left' ).replace( 'px', '' ) );

                _body.css( 'overflow-y', 'hidden' );

                _site.css( {
                    'position': 'relative',
                    'top': _position * -1
                } );

                _siteHead.addClass( 'open-menu' );

                if ( _window.outerWidth() >= 768 ){

                    _siteHead.css( {
                        'padding-left': headerLeftPadding,
                        'padding-right': headerRightPadding + _getScrollWidth()
                    } );

                    _citiesPopup.css( {
                        'padding-left': headerLeftPadding,
                        'padding-right': headerRightPadding + _getScrollWidth() + 17
                    } );

                    _closePopup.css( 'right', headerRightPadding + _getScrollWidth() );

                }

                _citiesWrap.niceScroll( {
                    cursorcolor: "#2f2f2f",
                    cursorwidth: "4px",
                    cursorborder: "0",
                    background: "#1a1a1a",
                    autohidemode: false
                } );

            },
            _hidePopupOnMobile = function () {

                _obj.removeClass( 'show' );

                _body.removeAttr( 'style' );
                _site.removeAttr( 'style' );
                _siteHead.removeClass( 'open-menu' );
                _siteHead.removeAttr( 'style' );

                console.log( _position )

                _window.scrollTop( _position );

                _citiesWrap.niceScroll( 'destroy' );

            },
            _initScheduleScroll = function () {

                if ( _countriesSlide.outerWidth() > _listCountries.outerWidth() ) {

                    _swiperCountries = new Swiper( _listCountries, {
                        direction: 'horizontal',
                        slidesPerView: 'auto',
                        freeMode: true,
                        mousewheel: true
                    } );

                }

            },
            _init = function() {
                _onEvent();
                _checkActiveTab();
                _initScheduleScroll();
            };

        //public properties

        //public methods

        _init();
    };

} )();
( function(){

    "use strict";

    $(function(){

        $.each( $( '.quote' ), function() {
            new Sliders ( $( this ) );
        } );

        $.each( $( '.navigation' ), function() {
            new Navigation ( $( this ) );
        } );

    } );

    var Navigation = function( obj ){

        //private properties
        var _obj = obj,
            _subCatalog = _obj.find( '.navigation__item' ),
            _subBtn = _subCatalog.find( 'a' ),
            _site = $( '.site' ),
            _siteHeader = _site.find( '.site__header' ),
            _siteAside = _site.find( '.site__aside' ),
            _featsWrap = _site.find( '.feats' ),
            _navTop = _siteAside.offset().top,
            _window = $( window ),
            _body = $( 'body' );

        //private methods
        var _init = function(){
                _onEvent();
            },
            _onEvent = function(){

                _site.on( 'click', function ( e ) {

                    if ( _subCatalog.hasClass( 'show' )&& $( e.target ).closest( _subCatalog ).length == 0 ){

                        _hideSubMenu();

                    }

                } );

                _subBtn.on( 'click', function () {

                    var curBtn = $( this );

                    if ( curBtn.next().is( 'ul' ) ){

                        var curMenu = curBtn.parents( '.navigation__item' );

                        if ( curMenu.hasClass( 'show' ) ){

                            _hideSubMenu();

                        } else {

                            curMenu.addClass( 'show' );

                            if ( _window.outerWidth() < 768 || _window.outerWidth() >= 1200 ){
                                curMenu.css( 'height', curMenu.outerHeight() + curBtn.next( 'ul' ).outerHeight() )
                            }

                        }

                        return false;

                    }

                } );

                _window.on( 'scroll', function ( ) {

                    if ( _window.outerWidth() >= 1200 ){
                        _checkScroll();
                    }

                } );

            },
            _checkScroll = function( ){

                if ( _window.scrollTop() + _siteHeader.outerHeight() + 10 >= _navTop ){

                    _siteAside.css( {
                        'position': 'fixed',
                        'top': _siteHeader.outerHeight() + 10,
                        'left': _obj.offset().left,
                        'bottom': 'auto',
                        'right': 'auto'
                    } );

                    if ( _featsWrap.offset().top + _featsWrap.outerHeight() <= _siteAside.offset().top + _siteAside.outerHeight() ){
                        _siteAside.css( {
                            'position': 'absolute',
                            'top': 'auto',
                            'bottom': 0,
                            'left': -329,
                            'right': 'auto'
                        } );
                    }

                } else if ( _window.scrollTop() + _siteHeader.outerHeight() + 10 <= _navTop ) {
                    _siteAside.removeAttr( 'style' );
                }

            },
            _hideSubMenu = function () {

                _subCatalog.removeClass( 'show' );

                if ( _window.outerWidth() < 768 || _window.outerWidth() >= 1200 ) {
                    _subCatalog.css('height', 59)
                }

            };

        //public properties

        //public methods

        _init();

    };

    var Sliders = function( obj ) {

        //private properties
        var _obj = obj,
            _quoteSlider = _obj.find( '.quote__slider' ),
            _quoteSlide = _obj.find( '.quote__slide' ),
            _quotePagination = _obj.find( '.quote__pagination' ),
            _quote;

        //private methods
        var _initSlider = function() {

                if ( _quoteSlide.length > 1 ) {

                    _quote = new Swiper ( _quoteSlider, {
                        effect: 'fade',
                        autoplay: 2500,
                        speed: 500,
                        slidesPerView: 1,
                        loop: true,
                        pagination: _quotePagination,
                        paginationClickable: true
                    } );

                }

            },
            _init = function() {
                _initSlider();
            };

        //public properties

        //public methods

        _init();
    };

} )();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5tYWluLmpzIiwianF1ZXJ5Lmluc2lkZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeldBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoIGZ1bmN0aW9uKCl7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgICQoZnVuY3Rpb24oKXtcblxuICAgICAgICAkLmVhY2goICQoICcubWVudScgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBuZXcgTWVudSAoICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICAgICAgJC5lYWNoKCAkKCAnLnNpdGVfX2hlYWRlcicgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBuZXcgSGVhZGVyICggJCggdGhpcyApICk7XG4gICAgICAgIH0gKTtcblxuICAgICAgICAkLmVhY2goICQoICcucGxhY2UnICksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbmV3IFBsYWNlICggJCggdGhpcyApICk7XG4gICAgICAgIH0gKTtcblxuICAgIH0gKTtcblxuICAgIHZhciBNZW51ID0gZnVuY3Rpb24oIG9iaiApIHtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9tb2JpbGVCdG4gPSAkKCAnLm1lbnUtbW9iaWxlLWJ0bicgKSxcbiAgICAgICAgICAgIF9jbG9zZUJ0biA9IF9vYmouZmluZCggJy5tZW51LWNsb3NlLWJ0bicgKSxcbiAgICAgICAgICAgIF9ib2R5ID0gJCggJ2JvZHknICksXG4gICAgICAgICAgICBfc2l0ZSA9IF9ib2R5LmZpbmQoICcuc2l0ZScgKSxcbiAgICAgICAgICAgIF9zaXRlSGVhZCA9IF9zaXRlLmZpbmQoICcuc2l0ZV9faGVhZGVyJyApLFxuICAgICAgICAgICAgX3dpbmRvdyA9ICQoIHdpbmRvdyApLFxuICAgICAgICAgICAgX3Bvc2l0aW9uID0gMDtcblxuICAgICAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgX29uRXZlbnQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIF9tb2JpbGVCdG4ub24oICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3Nob3dNb2JpbGVNZW51KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfY2xvc2VCdG4ub24oICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX2hpZGVNb2JpbGVNZW51KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaGlkZU1vYmlsZU1lbnUgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBfb2JqLnJlbW92ZUNsYXNzKCAnc2hvdycgKTtcblxuICAgICAgICAgICAgICAgIF9ib2R5LnJlbW92ZUF0dHIoICdzdHlsZScgKTtcbiAgICAgICAgICAgICAgICBfc2l0ZS5yZW1vdmVBdHRyKCAnc3R5bGUnICk7XG4gICAgICAgICAgICAgICAgX3NpdGVIZWFkLnJlbW92ZUNsYXNzKCAnb3Blbi1tZW51JyApO1xuXG4gICAgICAgICAgICAgICAgX3dpbmRvdy5zY3JvbGxUb3AoIF9wb3NpdGlvbiApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3dNb2JpbGVNZW51ID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ3Nob3cnICk7XG5cbiAgICAgICAgICAgICAgICBfcG9zaXRpb24gPSBfd2luZG93LnNjcm9sbFRvcCgpO1xuXG4gICAgICAgICAgICAgICAgX2JvZHkuY3NzKCAnb3ZlcmZsb3cteScsICdoaWRkZW4nICk7XG5cbiAgICAgICAgICAgICAgICBfc2l0ZS5jc3MoIHtcbiAgICAgICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJyxcbiAgICAgICAgICAgICAgICAgICAgJ3RvcCc6IF9wb3NpdGlvbiAqIC0xXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgX3NpdGVIZWFkLmFkZENsYXNzKCAnb3Blbi1tZW51JyApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfb25FdmVudCgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9pbml0KCk7XG4gICAgfTtcblxuICAgIHZhciBIZWFkZXIgPSBmdW5jdGlvbiggb2JqICkge1xuXG4gICAgICAgIC8vcHJpdmF0ZSBwcm9wZXJ0aWVzXG4gICAgICAgIHZhciBfb2JqID0gb2JqLFxuICAgICAgICAgICAgX2hlcm8gPSAkKCAnLmhlcm8nICksXG4gICAgICAgICAgICBfaGVyb0JvdHRvbVNldCA9IDAsXG4gICAgICAgICAgICBfaGVhZGVyQm90dG9tU2V0ID0gMCxcbiAgICAgICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKTtcblxuICAgICAgICAgICAgaWYgKCBfaGVyby5sZW5ndGggPiAwICl7XG5cbiAgICAgICAgICAgICAgICBfaGVyb0JvdHRvbVNldCA9IF9oZXJvLm9mZnNldCgpLnRvcCArIF9oZXJvLm91dGVySGVpZ2h0KCk7XG4gICAgICAgICAgICAgICAgX2hlYWRlckJvdHRvbVNldCA9IF9vYmoub2Zmc2V0KCkudG9wICsgX29iai5vdXRlckhlaWdodCgpO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgLy9wcml2YXRlIG1ldGhvZHNcbiAgICAgICAgdmFyIF9vbkV2ZW50ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICBfd2luZG93Lm9uKCAnc2Nyb2xsJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBfY2hlY2tTY3JvbGwoKTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY2hlY2tTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9oZWFkZXJCb3R0b21TZXQgKiA1IDwgX3dpbmRvdy5zY3JvbGxUb3AoKSAmJiBfd2luZG93LnNjcm9sbFRvcCgpIDwgX2hlcm9Cb3R0b21TZXQgKXtcbiAgICAgICAgICAgICAgICAgICAgX2hpZGVIZWFkZXIoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBfd2luZG93LnNjcm9sbFRvcCgpID4gX2hlcm9Cb3R0b21TZXQgKSB7XG4gICAgICAgICAgICAgICAgICAgIF9maXhlZEhlYWRlcigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIF9oZWFkZXJPblRvcCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oaWRlSGVhZGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9vYmouYWRkQ2xhc3MoICdoaWRlJyApO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9maXhlZEhlYWRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBfb2JqLmFkZENsYXNzKCAnZml4ZWQnICk7XG4gICAgICAgICAgICAgICAgX29iai5yZW1vdmVDbGFzcyggJ2hpZGUnICk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hlYWRlck9uVG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdoaWRlJyApO1xuICAgICAgICAgICAgICAgIF9vYmoucmVtb3ZlQ2xhc3MoICdmaXhlZCcgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICAgICAgX2NoZWNrU2Nyb2xsKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgIC8vcHVibGljIHByb3BlcnRpZXNcblxuICAgICAgICAvL3B1YmxpYyBtZXRob2RzXG5cbiAgICAgICAgX2luaXQoKTtcbiAgICB9O1xuXG4gICAgdmFyIFBsYWNlID0gZnVuY3Rpb24oIG9iaiApIHtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9jdXJDaXR5ID0gX29iai5maW5kKCAnLnBsYWNlX19jdXJyZW50JyApLFxuICAgICAgICAgICAgX2NpdGllc1BvcHVwID0gX29iai5maW5kKCAnLnBsYWNlX19wb3B1cCcgKSxcbiAgICAgICAgICAgIF9jaXRpZXNXcmFwID0gX2NpdGllc1BvcHVwLmZpbmQoICcucGxhY2VfX2NpdGllcycgKSxcbiAgICAgICAgICAgIF9saXN0Q291bnRyaWVzID0gX2NpdGllc1BvcHVwLmZpbmQoICcucGxhY2VfX2NvdW50cmllcycgKSxcbiAgICAgICAgICAgIF9jb3VudHJpZXNTbGlkZSA9IF9saXN0Q291bnRyaWVzLmZpbmQoICcuc3dpcGVyLXNsaWRlJyApLFxuICAgICAgICAgICAgX2xpc3RDb3VudHJ5SXRlbSA9IF9saXN0Q291bnRyaWVzLmZpbmQoICcucGxhY2VfX2NvdW50cmllcy1pdGVtJyApLFxuICAgICAgICAgICAgX2Nsb3NlUG9wdXAgPSBfY2l0aWVzUG9wdXAuZmluZCggJy5wbGFjZV9fcG9wdXAtY2xvc2UnICksXG4gICAgICAgICAgICBfYm9keSA9ICQoICdib2R5JyApLFxuICAgICAgICAgICAgX3NpdGUgPSAkKCAnLnNpdGUnICksXG4gICAgICAgICAgICBfc2l0ZUhlYWQgPSBfc2l0ZS5maW5kKCAnLnNpdGVfX2hlYWRlcicgKSxcbiAgICAgICAgICAgIF93aW5kb3cgPSAkKCB3aW5kb3cgKSxcbiAgICAgICAgICAgIF9wb3NpdGlvbiA9IDAsXG4gICAgICAgICAgICBfc3dpcGVyQ291bnRyaWVzLFxuICAgICAgICAgICAgX3JlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgICAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgX29uRXZlbnQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIF9zaXRlLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoIGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICggX29iai5oYXNDbGFzcyggJ3Nob3cnICkgJiYgJCggZS50YXJnZXQgKS5jbG9zZXN0KCBfb2JqICkubGVuZ3RoID09IDAgJiYgX3dpbmRvdy53aWR0aCgpIDw9IDEyMDAgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9oaWRlUG9wdXBPbk1vYmlsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgX2N1ckNpdHkub24oICdjbGljaycsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoICFfc2l0ZUhlYWQuaGFzQ2xhc3MoICdvcGVuLW1lbnUnICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfc2hvd1BvcHVwT25Nb2JpbGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgX2Nsb3NlUG9wdXAub24oICdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX2hpZGVQb3B1cE9uTW9iaWxlKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfbGlzdENvdW50cnlJdGVtLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1dENvdW50cnkgPSAkKCB0aGlzICk7XG5cbiAgICAgICAgICAgICAgICAgICAgX2FqYXhSZXF1ZXN0KCBjdXRDb3VudHJ5ICk7XG5cbiAgICAgICAgICAgICAgICAgICAgX2xpc3RDb3VudHJ5SXRlbS5yZW1vdmVDbGFzcyggJ2FjdGl2ZScgKTtcbiAgICAgICAgICAgICAgICAgICAgY3V0Q291bnRyeS5hZGRDbGFzcyggJ2FjdGl2ZScgKTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2FqYXhSZXF1ZXN0ID0gZnVuY3Rpb24oIGNvdW50cnlPYmogKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY3V0Q291bnRyeSA9IGNvdW50cnlPYmosXG4gICAgICAgICAgICAgICAgICAgIGN1dENvdW50cnlJZCA9IGN1dENvdW50cnkuZGF0YSggJ2NvdW50cnknICk7XG5cbiAgICAgICAgICAgICAgICBfcmVxdWVzdCA9ICQuYWpheCgge1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICdwaHAvY2l0eS5nZW8ucGhwJyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRyeV9pZDogY3V0Q291bnRyeUlkXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoIGRhdGEgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY29uc3RydWN0RGF0YSggZGF0YSApO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKCBYTUxIdHRwUmVxdWVzdCApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggWE1MSHR0cFJlcXVlc3Quc3RhdHVzVGV4dCAhPSBcImFib3J0XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coICdlcnInICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfY2hlY2tBY3RpdmVUYWIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9saXN0Q291bnRyeUl0ZW0uZmlsdGVyKCAnYWN0aXZlJyApLmxlbmd0aCA9PSAwICl7XG5cbiAgICAgICAgICAgICAgICAgICAgX2xpc3RDb3VudHJ5SXRlbS5lcSggMCApLnRyaWdnZXIoICdjbGljaycgKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9jb25zdHJ1Y3REYXRhID0gZnVuY3Rpb24gKCBkYXRhICkge1xuXG4gICAgICAgICAgICAgICAgX2NpdGllc1dyYXAuZW1wdHkoKTtcblxuICAgICAgICAgICAgICAgICQuZWFjaCggZGF0YSwgZnVuY3Rpb24gKCBpICkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciBsaXN0ID0gJCggJzxkbD48L2RsPicgKTtcblxuICAgICAgICAgICAgICAgICAgICBmb3IgKCB2YXIgbiA9IDA7IG4gPCBkYXRhLmxlbmd0aDsgbisrICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmFwcGVuZCggJzxkdD4nKyBkYXRhWyBpIF1bIG4gXS5ncm91cCArJzwvZHQ+JyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5hcHBlbmQoIF9hcHBlbmRDaXRpZXMoIGRhdGFbIGkgXVsgbiBdLmNpdHkgKSApO1xuXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgX2NpdGllc1dyYXAuYXBwZW5kKCBsaXN0ICk7XG5cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfYXBwZW5kQ2l0aWVzID0gZnVuY3Rpb24gKCBkYXRhICkge1xuXG4gICAgICAgICAgICAgICAgdmFyIGxpc3QgPSAkKCAnPGRkPjwvZGQ+JyApO1xuXG4gICAgICAgICAgICAgICAgZm9yICggdmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKyApIHtcblxuICAgICAgICAgICAgICAgICAgICBsaXN0LmFwcGVuZCggJzxhIGhyZWY9XCInKyBkYXRhWyBpIF0ubGluayArJ1wiPicrIGRhdGFbIGkgXS5uYW1lICArJzwvYT4nICk7XG5cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpc3Q7XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfZ2V0U2Nyb2xsV2lkdGggPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggJ2RpdicpLFxuICAgICAgICAgICAgICAgICAgICBzY3JvbGxCYXJXaWR0aDtcblxuICAgICAgICAgICAgICAgIHNjcm9sbERpdi5jbGFzc05hbWUgPSAncGxhY2VfX3Njcm9sbGJhci1tZWFzdXJlJztcblxuICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoIHNjcm9sbERpdiApO1xuXG4gICAgICAgICAgICAgICAgc2Nyb2xsQmFyV2lkdGggPSBzY3JvbGxEaXYub2Zmc2V0V2lkdGggLSBzY3JvbGxEaXYuY2xpZW50V2lkdGg7XG5cbiAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHNjcm9sbERpdik7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gc2Nyb2xsQmFyV2lkdGg7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX3Nob3dQb3B1cE9uTW9iaWxlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgX29iai5hZGRDbGFzcyggJ3Nob3cnICk7XG5cbiAgICAgICAgICAgICAgICBfcG9zaXRpb24gPSBfd2luZG93LnNjcm9sbFRvcCgpO1xuXG4gICAgICAgICAgICAgICAgdmFyIGhlYWRlclJpZ2h0UGFkZGluZyA9ICsoIF9zaXRlSGVhZC5jc3MoICdwYWRkaW5nLXJpZ2h0JyApLnJlcGxhY2UoICdweCcsICcnICkgKSxcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyTGVmdFBhZGRpbmcgPSArKCBfc2l0ZUhlYWQuY3NzKCAncGFkZGluZy1sZWZ0JyApLnJlcGxhY2UoICdweCcsICcnICkgKTtcblxuICAgICAgICAgICAgICAgIF9ib2R5LmNzcyggJ292ZXJmbG93LXknLCAnaGlkZGVuJyApO1xuXG4gICAgICAgICAgICAgICAgX3NpdGUuY3NzKCB7XG4gICAgICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScsXG4gICAgICAgICAgICAgICAgICAgICd0b3AnOiBfcG9zaXRpb24gKiAtMVxuICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgIF9zaXRlSGVhZC5hZGRDbGFzcyggJ29wZW4tbWVudScgKTtcblxuICAgICAgICAgICAgICAgIGlmICggX3dpbmRvdy5vdXRlcldpZHRoKCkgPj0gNzY4ICl7XG5cbiAgICAgICAgICAgICAgICAgICAgX3NpdGVIZWFkLmNzcygge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3BhZGRpbmctbGVmdCc6IGhlYWRlckxlZnRQYWRkaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3BhZGRpbmctcmlnaHQnOiBoZWFkZXJSaWdodFBhZGRpbmcgKyBfZ2V0U2Nyb2xsV2lkdGgoKVxuICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICAgICAgX2NpdGllc1BvcHVwLmNzcygge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3BhZGRpbmctbGVmdCc6IGhlYWRlckxlZnRQYWRkaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3BhZGRpbmctcmlnaHQnOiBoZWFkZXJSaWdodFBhZGRpbmcgKyBfZ2V0U2Nyb2xsV2lkdGgoKSArIDE3XG4gICAgICAgICAgICAgICAgICAgIH0gKTtcblxuICAgICAgICAgICAgICAgICAgICBfY2xvc2VQb3B1cC5jc3MoICdyaWdodCcsIGhlYWRlclJpZ2h0UGFkZGluZyArIF9nZXRTY3JvbGxXaWR0aCgpICk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfY2l0aWVzV3JhcC5uaWNlU2Nyb2xsKCB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnNvcmNvbG9yOiBcIiMyZjJmMmZcIixcbiAgICAgICAgICAgICAgICAgICAgY3Vyc29yd2lkdGg6IFwiNHB4XCIsXG4gICAgICAgICAgICAgICAgICAgIGN1cnNvcmJvcmRlcjogXCIwXCIsXG4gICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IFwiIzFhMWExYVwiLFxuICAgICAgICAgICAgICAgICAgICBhdXRvaGlkZW1vZGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2hpZGVQb3B1cE9uTW9iaWxlID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgX29iai5yZW1vdmVDbGFzcyggJ3Nob3cnICk7XG5cbiAgICAgICAgICAgICAgICBfYm9keS5yZW1vdmVBdHRyKCAnc3R5bGUnICk7XG4gICAgICAgICAgICAgICAgX3NpdGUucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuICAgICAgICAgICAgICAgIF9zaXRlSGVhZC5yZW1vdmVDbGFzcyggJ29wZW4tbWVudScgKTtcbiAgICAgICAgICAgICAgICBfc2l0ZUhlYWQucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coIF9wb3NpdGlvbiApXG5cbiAgICAgICAgICAgICAgICBfd2luZG93LnNjcm9sbFRvcCggX3Bvc2l0aW9uICk7XG5cbiAgICAgICAgICAgICAgICBfY2l0aWVzV3JhcC5uaWNlU2Nyb2xsKCAnZGVzdHJveScgKTtcblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9pbml0U2NoZWR1bGVTY3JvbGwgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF9jb3VudHJpZXNTbGlkZS5vdXRlcldpZHRoKCkgPiBfbGlzdENvdW50cmllcy5vdXRlcldpZHRoKCkgKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgX3N3aXBlckNvdW50cmllcyA9IG5ldyBTd2lwZXIoIF9saXN0Q291bnRyaWVzLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb246ICdob3Jpem9udGFsJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1BlclZpZXc6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyZWVNb2RlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgbW91c2V3aGVlbDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBfaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICAgICAgX2NoZWNrQWN0aXZlVGFiKCk7XG4gICAgICAgICAgICAgICAgX2luaXRTY2hlZHVsZVNjcm9sbCgpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9pbml0KCk7XG4gICAgfTtcblxufSApKCk7IiwiKCBmdW5jdGlvbigpe1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAkKGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgJC5lYWNoKCAkKCAnLnF1b3RlJyApLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG5ldyBTbGlkZXJzICggJCggdGhpcyApICk7XG4gICAgICAgIH0gKTtcblxuICAgICAgICAkLmVhY2goICQoICcubmF2aWdhdGlvbicgKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBuZXcgTmF2aWdhdGlvbiAoICQoIHRoaXMgKSApO1xuICAgICAgICB9ICk7XG5cbiAgICB9ICk7XG5cbiAgICB2YXIgTmF2aWdhdGlvbiA9IGZ1bmN0aW9uKCBvYmogKXtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9zdWJDYXRhbG9nID0gX29iai5maW5kKCAnLm5hdmlnYXRpb25fX2l0ZW0nICksXG4gICAgICAgICAgICBfc3ViQnRuID0gX3N1YkNhdGFsb2cuZmluZCggJ2EnICksXG4gICAgICAgICAgICBfc2l0ZSA9ICQoICcuc2l0ZScgKSxcbiAgICAgICAgICAgIF9zaXRlSGVhZGVyID0gX3NpdGUuZmluZCggJy5zaXRlX19oZWFkZXInICksXG4gICAgICAgICAgICBfc2l0ZUFzaWRlID0gX3NpdGUuZmluZCggJy5zaXRlX19hc2lkZScgKSxcbiAgICAgICAgICAgIF9mZWF0c1dyYXAgPSBfc2l0ZS5maW5kKCAnLmZlYXRzJyApLFxuICAgICAgICAgICAgX25hdlRvcCA9IF9zaXRlQXNpZGUub2Zmc2V0KCkudG9wLFxuICAgICAgICAgICAgX3dpbmRvdyA9ICQoIHdpbmRvdyApLFxuICAgICAgICAgICAgX2JvZHkgPSAkKCAnYm9keScgKTtcblxuICAgICAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgX2luaXQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIF9vbkV2ZW50KCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX29uRXZlbnQgPSBmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgX3NpdGUub24oICdjbGljaycsIGZ1bmN0aW9uICggZSApIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIF9zdWJDYXRhbG9nLmhhc0NsYXNzKCAnc2hvdycgKSYmICQoIGUudGFyZ2V0ICkuY2xvc2VzdCggX3N1YkNhdGFsb2cgKS5sZW5ndGggPT0gMCApe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBfaGlkZVN1Yk1lbnUoKTtcblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICBfc3ViQnRuLm9uKCAnY2xpY2snLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGN1ckJ0biA9ICQoIHRoaXMgKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIGN1ckJ0bi5uZXh0KCkuaXMoICd1bCcgKSApe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VyTWVudSA9IGN1ckJ0bi5wYXJlbnRzKCAnLm5hdmlnYXRpb25fX2l0ZW0nICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggY3VyTWVudS5oYXNDbGFzcyggJ3Nob3cnICkgKXtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9oaWRlU3ViTWVudSgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyTWVudS5hZGRDbGFzcyggJ3Nob3cnICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIF93aW5kb3cub3V0ZXJXaWR0aCgpIDwgNzY4IHx8IF93aW5kb3cub3V0ZXJXaWR0aCgpID49IDEyMDAgKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyTWVudS5jc3MoICdoZWlnaHQnLCBjdXJNZW51Lm91dGVySGVpZ2h0KCkgKyBjdXJCdG4ubmV4dCggJ3VsJyApLm91dGVySGVpZ2h0KCkgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgX3dpbmRvdy5vbiggJ3Njcm9sbCcsIGZ1bmN0aW9uICggKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfd2luZG93Lm91dGVyV2lkdGgoKSA+PSAxMjAwICl7XG4gICAgICAgICAgICAgICAgICAgICAgICBfY2hlY2tTY3JvbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2NoZWNrU2Nyb2xsID0gZnVuY3Rpb24oICl7XG5cbiAgICAgICAgICAgICAgICBpZiAoIF93aW5kb3cuc2Nyb2xsVG9wKCkgKyBfc2l0ZUhlYWRlci5vdXRlckhlaWdodCgpICsgMTAgPj0gX25hdlRvcCApe1xuXG4gICAgICAgICAgICAgICAgICAgIF9zaXRlQXNpZGUuY3NzKCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAnZml4ZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3RvcCc6IF9zaXRlSGVhZGVyLm91dGVySGVpZ2h0KCkgKyAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdsZWZ0JzogX29iai5vZmZzZXQoKS5sZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2JvdHRvbSc6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdyaWdodCc6ICdhdXRvJ1xuICAgICAgICAgICAgICAgICAgICB9ICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCBfZmVhdHNXcmFwLm9mZnNldCgpLnRvcCArIF9mZWF0c1dyYXAub3V0ZXJIZWlnaHQoKSA8PSBfc2l0ZUFzaWRlLm9mZnNldCgpLnRvcCArIF9zaXRlQXNpZGUub3V0ZXJIZWlnaHQoKSApe1xuICAgICAgICAgICAgICAgICAgICAgICAgX3NpdGVBc2lkZS5jc3MoIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0b3AnOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2JvdHRvbSc6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2xlZnQnOiAtMzI5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyaWdodCc6ICdhdXRvJ1xuICAgICAgICAgICAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBfd2luZG93LnNjcm9sbFRvcCgpICsgX3NpdGVIZWFkZXIub3V0ZXJIZWlnaHQoKSArIDEwIDw9IF9uYXZUb3AgKSB7XG4gICAgICAgICAgICAgICAgICAgIF9zaXRlQXNpZGUucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF9oaWRlU3ViTWVudSA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgICAgIF9zdWJDYXRhbG9nLnJlbW92ZUNsYXNzKCAnc2hvdycgKTtcblxuICAgICAgICAgICAgICAgIGlmICggX3dpbmRvdy5vdXRlcldpZHRoKCkgPCA3NjggfHwgX3dpbmRvdy5vdXRlcldpZHRoKCkgPj0gMTIwMCApIHtcbiAgICAgICAgICAgICAgICAgICAgX3N1YkNhdGFsb2cuY3NzKCdoZWlnaHQnLCA1OSlcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgLy9wdWJsaWMgcHJvcGVydGllc1xuXG4gICAgICAgIC8vcHVibGljIG1ldGhvZHNcblxuICAgICAgICBfaW5pdCgpO1xuXG4gICAgfTtcblxuICAgIHZhciBTbGlkZXJzID0gZnVuY3Rpb24oIG9iaiApIHtcblxuICAgICAgICAvL3ByaXZhdGUgcHJvcGVydGllc1xuICAgICAgICB2YXIgX29iaiA9IG9iaixcbiAgICAgICAgICAgIF9xdW90ZVNsaWRlciA9IF9vYmouZmluZCggJy5xdW90ZV9fc2xpZGVyJyApLFxuICAgICAgICAgICAgX3F1b3RlU2xpZGUgPSBfb2JqLmZpbmQoICcucXVvdGVfX3NsaWRlJyApLFxuICAgICAgICAgICAgX3F1b3RlUGFnaW5hdGlvbiA9IF9vYmouZmluZCggJy5xdW90ZV9fcGFnaW5hdGlvbicgKSxcbiAgICAgICAgICAgIF9xdW90ZTtcblxuICAgICAgICAvL3ByaXZhdGUgbWV0aG9kc1xuICAgICAgICB2YXIgX2luaXRTbGlkZXIgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgIGlmICggX3F1b3RlU2xpZGUubGVuZ3RoID4gMSApIHtcblxuICAgICAgICAgICAgICAgICAgICBfcXVvdGUgPSBuZXcgU3dpcGVyICggX3F1b3RlU2xpZGVyLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlZmZlY3Q6ICdmYWRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9wbGF5OiAyNTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3BlZWQ6IDUwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBsb29wOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvbjogX3F1b3RlUGFnaW5hdGlvbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2luYXRpb25DbGlja2FibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSApO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgX2luaXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBfaW5pdFNsaWRlcigpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAvL3B1YmxpYyBwcm9wZXJ0aWVzXG5cbiAgICAgICAgLy9wdWJsaWMgbWV0aG9kc1xuXG4gICAgICAgIF9pbml0KCk7XG4gICAgfTtcblxufSApKCk7Il19
